<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title></title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="custom.css">
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="acknowledgments.html"><strong aria-hidden="true">2.</strong> Acknowledgments</a></li><li class="chapter-item expanded "><a href="text-and-links/index.html"><strong aria-hidden="true">3.</strong> Text and Links</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="text-and-links/text-formatting.html"><strong aria-hidden="true">3.1.</strong> Text Formatting</a></li><li class="chapter-item expanded "><a href="text-and-links/simple-links.html"><strong aria-hidden="true">3.2.</strong> Simple Links</a></li><li class="chapter-item expanded "><a href="text-and-links/forks.html"><strong aria-hidden="true">3.3.</strong> Forks</a></li><li class="chapter-item expanded "><a href="text-and-links/ways-to-link.html"><strong aria-hidden="true">3.4.</strong> Ways to Link</a></li><li class="chapter-item expanded "><a href="text-and-links/backstage.html"><strong aria-hidden="true">3.5.</strong> Introducing Backstage</a></li></ol></li><li class="chapter-item expanded "><a href="modifiers-and-inserts/index.html"><strong aria-hidden="true">4.</strong> Modifiers and Inserts</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="modifiers-and-inserts/modifiers-and-text-alignment.html"><strong aria-hidden="true">4.1.</strong> Modifiers and Text Alignment</a></li><li class="chapter-item expanded "><a href="modifiers-and-inserts/delayed-text.html"><strong aria-hidden="true">4.2.</strong> Delayed Text</a></li><li class="chapter-item expanded "><a href="modifiers-and-inserts/notes.html"><strong aria-hidden="true">4.3.</strong> Notes</a></li><li class="chapter-item expanded "><a href="modifiers-and-inserts/link-inserts.html"><strong aria-hidden="true">4.4.</strong> Link Inserts</a></li><li class="chapter-item expanded "><a href="modifiers-and-inserts/reveal-links.html"><strong aria-hidden="true">4.5.</strong> Reveal Links</a></li><li class="chapter-item expanded "><a href="modifiers-and-inserts/embedding-passages.html"><strong aria-hidden="true">4.6.</strong> Embedding Passages</a></li></ol></li><li class="chapter-item expanded "><a href="state/index.html"><strong aria-hidden="true">5.</strong> Adding State to Stories</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="state/what-is-state.html"><strong aria-hidden="true">5.1.</strong> What is State?</a></li><li class="chapter-item expanded "><a href="state/the-vars-section.html"><strong aria-hidden="true">5.2.</strong> The Vars Section</a></li><li class="chapter-item expanded "><a href="state/displaying-variables.html"><strong aria-hidden="true">5.3.</strong> Displaying Variables</a></li><li class="chapter-item expanded "><a href="state/conditional-display.html"><strong aria-hidden="true">5.4.</strong> Conditional Display</a></li><li class="chapter-item expanded "><a href="state/conditions-and-variables.html"><strong aria-hidden="true">5.5.</strong> Conditions and Variables</a></li><li class="chapter-item expanded "><a href="state/continuity.html"><strong aria-hidden="true">5.6.</strong> Continuity Between Sessions</a></li><li class="chapter-item expanded "><a href="state/backstage.html"><strong aria-hidden="true">5.7.</strong> State Backstage</a></li><li class="chapter-item expanded "><a href="state/objects-and-lookups.html"><strong aria-hidden="true">5.8.</strong> Objects and Lookup Variables</a></li><li class="chapter-item expanded "><a href="state/randomness.html"><strong aria-hidden="true">5.9.</strong> Randomness</a></li></ol></li><li class="chapter-item expanded "><a href="multimedia/index.html"><strong aria-hidden="true">6.</strong> Multimedia</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="multimedia/publishing-models.html"><strong aria-hidden="true">6.1.</strong> Publishing Models</a></li><li class="chapter-item expanded "><a href="multimedia/images.html"><strong aria-hidden="true">6.2.</strong> Images</a></li><li class="chapter-item expanded "><a href="multimedia/audio.html"><strong aria-hidden="true">6.3.</strong> Audio</a></li><li class="chapter-item expanded "><a href="multimedia/video.html"><strong aria-hidden="true">6.4.</strong> Video</a></li></ol></li><li class="chapter-item expanded "><a href="customization/index.html"><strong aria-hidden="true">7.</strong> Customization</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="customization/header-and-footer.html"><strong aria-hidden="true">7.1.</strong> The Header and Footer</a></li><li class="chapter-item expanded "><a href="customization/fonts-and-colors.html"><strong aria-hidden="true">7.2.</strong> Fonts and Colors</a></li><li class="chapter-item expanded "><a href="customization/external-web-fonts.html"><strong aria-hidden="true">7.3.</strong> External Web Fonts</a></li><li class="chapter-item expanded "><a href="customization/page-style.html"><strong aria-hidden="true">7.4.</strong> Page Style</a></li><li class="chapter-item expanded "><a href="customization/fork-style.html"><strong aria-hidden="true">7.5.</strong> Fork Style</a></li><li class="chapter-item expanded "><a href="customization/design-considerations.html"><strong aria-hidden="true">7.6.</strong> Design Considerations</a></li></ol></li><li class="chapter-item expanded "><a href="player-input/index.html"><strong aria-hidden="true">8.</strong> Player Input</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="player-input/text-input.html"><strong aria-hidden="true">8.1.</strong> Text Input</a></li><li class="chapter-item expanded "><a href="player-input/dropdown-menus-cycling-links.html"><strong aria-hidden="true">8.2.</strong> Dropdown Menus and Cycling Links</a></li></ol></li><li class="chapter-item expanded "><a href="advanced/index.html"><strong aria-hidden="true">9.</strong> Advanced Topics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="advanced/using-javascript-in-passages.html"><strong aria-hidden="true">9.1.</strong> Using JavaScript in Passages</a></li><li class="chapter-item expanded "><a href="advanced/using-css-in-passages.html"><strong aria-hidden="true">9.2.</strong> Using CSS in Passages</a></li><li class="chapter-item expanded "><a href="advanced/adding-custom-inserts.html"><strong aria-hidden="true">9.3.</strong> Adding Custom Inserts</a></li><li class="chapter-item expanded "><a href="advanced/adding-custom-modifiers.html"><strong aria-hidden="true">9.4.</strong> Adding Custom Modifiers</a></li></ol></li><li class="chapter-item expanded "><a href="references/index.html"><strong aria-hidden="true">10.</strong> References</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="references/inserts.html"><strong aria-hidden="true">10.1.</strong> Inserts</a></li><li class="chapter-item expanded "><a href="references/modifiers.html"><strong aria-hidden="true">10.2.</strong> Modifiers</a></li><li class="chapter-item expanded "><a href="references/version-history.html"><strong aria-hidden="true">10.3.</strong> Version History</a></li><li class="chapter-item expanded "><a href="references/lifecycle.html"><strong aria-hidden="true">10.4.</strong> The Chapbook Lifecycle</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <div class="intro intro-path">
    <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
</div>
<p>This is a guide to the Chapbook story format for Twine 2.<sup class="footnote-reference"><a href="#1">1</a></sup> Story formats control how a story created with the Twine editor plays in a Web browser; once you select the <strong>Play</strong> button in Twine or publish your story to a file, whatever story format you have selected takes over.</p>
<p>Chapbook is designed to be easy to work with as an author and generate output that is a pleasure to read by players. It provides sensible default behaviors for your story that can be customized to fit your particular needs.</p>
<p>This guide does not assume you have any programming knowledge; however, it doesn't hurt to know CSS or JavaScript, as it uses both technologies heavily. It's split into several chapters that will gently guide you through the process of story creation.</p>
<p>This guide does assume, however, that you're familiar with the Twine 2 editor itself. If you're new to Twine, the <a href="http://twinery.org/wiki/twine2:guide">Twine 2 guide</a> is an excellent place to start. There are also numerous tutorials on the web that can be helpful.</p>
<h2 id="licensing"><a class="header" href="#licensing">Licensing</a></h2>
<p>Chapbook is released under the <a href="mit-license">MIT license</a>. Broadly speaking, it can be used to create free and commercial works alike without royalty payment of any kind. Mentioning Chapbook and Twine in the credits of your work isn't required, but it is appreciated.</p>
<p>Because Chapbook is open source, its ongoing development and maintenance is supported by <a href="https://patreon.com/klembot">Patreon supporters</a> like:</p>
<div class="patreon-supporters">
    <ul>
		<li>Adia Alderson</li>
		<li>Albert Gyulgazyan</li>
		<li>Aly Albansky</li>
		<li>Anastasia Salter</li>
		<li>Andrew Smith</li>
		<li>Antonio Garcia</li>
		<li>Ben McKenzie</li>
		<li>Ben Sawyer</li>
		<li>Brendan Hennessy</li>
		<li>Caelyn Sandel</li>
		<li>Cathie LeBlanc</li>
		<li>Chris Martens</li>
		<li>Clive Henrick</li>
		<li>Dan Q</li>
		<li>Dan Steward</li>
		<li>David Ball</li>
		<li>Duane Johnson</li>
		<li>Emily Short</li>
		<li>Ian</li>
		<li>Jim Graziano</li>
		<li>Joe Nobody</li>
		<li>John Boyland</li>
		<li>John Chapman</li>
		<li>John McDaid</li>
		<li>Jonathan Huston</li>
		<li>José Dias</li>
		<li>JRUndercover</li>
		<li>Laura Gibbs</li>
		<li>Leanne Taylor-Giles</li>
		<li>Luc Schurgers</li>
		<li>Matt Campbell</li>
		<li>Molly Jameson</li>
		<li>Richard Holeton</li>
		<li>Robot Parking</li>
		<li>Soliriok</li>
		<li>Stephen Sun</li>
		<li>Stephen Wardle</li>
		<li>Stuart Moulthrop</li>
		<li>Thandle2</li>
		<li>Tim Thompson</li>
		<li>Tom</li>
		<li>Venceremos</li>
    </ul>
</div>
<p>Supporters at particular tiers receive access to devlogs and other rewards. If you use Chapbook, please consider <a href="https://patreon.com/klembot">supporting the project on Patreon</a>.</p>
<h2 id="browser-support"><a class="header" href="#browser-support">Browser Support</a></h2>
<p>Chapbook supports the <code>defaults</code> set of web browsers set by <a href="https://github.com/browserslist/browserslist">the browserslist project</a>. You can view what that entails in detail <a href="https://browserl.ist/">on browserl.ist</a>.</p>
<h2 id="how-to-use-chapbook"><a class="header" href="#how-to-use-chapbook">How to Use Chapbook</a></h2>
<p>Chapbook is bundled as part of the Twine 2 editor now, though releases of Twine sometimes lag behind Chapbook. If you would like to use it separately, or update by hand, choose the <strong>Formats</strong> button from the story list page you see when you first start up Twine, then the <strong>Add a New Format</strong> tab at the top of the dialog that appears. Paste the following address into the field and select the <strong>Go</strong> button:</p>
<pre><code>https://klembot.github.io/chapbook/use/1.2.0/format.js
</code></pre>
<p>Once you do that, you must set the story you're working with to publish using Chapbook. Edit one of your stories, then choose <strong>Change Story Format</strong> from the story menu at the bottom of the editor. Choose Chapbook here. Once you do, selecting the <strong>Play</strong> button or publishing your story to a file will use Chapbook format.</p>
<p>To use the micro version of Chapbook, which removes all debugging-related code, add this address instead:</p>
<pre><code>https://klembot.github.io/chapbook/use/1.2.0-micro/format.js
</code></pre>
<h2 id="why-to-use-chapbook"><a class="header" href="#why-to-use-chapbook">Why To Use Chapbook</a></h2>
<p>There is a relative embarassment of riches when it comes to selecting a Twine 2 story format. What are Chapbook's advantages?</p>
<ul>
<li>
<p>Chapbook source code is easy to read. It disallows certain practices, such
as nesting conditional statements<sup class="footnote-reference"><a href="#2">2</a></sup>, and enforces others, like placing all
variable declarations in one place in a passage, that lead to
easier-to-follow code.</p>
</li>
<li>
<p>Chapbook has built-in functionality for common authoring scenarios. From
cycling links to delayed text, many things you'll want to do with your
stories will only require a single line of code.</p>
</li>
<li>
<p>Chapbook has a backstage view that aids in testing; it allows you to inspect
the state of play, change variables on the fly, and save state anywhere so
that you can quickly debug a particular part of your story.</p>
</li>
<li>
<p>Chapbook is designed to be used on a variety of devices, especially mobile
ones. It uses responsive design to adapt its page layout so that it's
readable on any type of device without having to zoom in or scroll
unnecessarily. It also is lightweight-- it currently contains 120K of code,
which takes less than a second to load on cellular networks.</p>
</li>
<li>
<p>Chapbook's appearance can be customized without knowing HTML or CSS, and has
built-in tools that allow you to preview style changes in your story
immediately, so you can craft the appearance you're looking for without
having to learn browser developer tools.</p>
</li>
</ul>
<h2 id="why-not-to-use-chapbook"><a class="header" href="#why-not-to-use-chapbook">Why Not To Use Chapbook</a></h2>
<ul>
<li>
<p>Chapbook is young. This means that resources apart from this guide are
scarce compared to the many tutorials you'll find related to the venerable
formats SugarCube and Harlowe. And there will be fewer people to turn to if
you have a question or encounter a problem.</p>
</li>
<li>
<p>You've invested significant time already in learning another story format.
There's nothing that Chapbook can do that other formats can't. It may be
easier to write with, depending on your point of view, but if you've already
spent the time to learn how to write for another story format, it may not be
worth the time investment.</p>
</li>
</ul>
<h2 id="an-aside-on-names"><a class="header" href="#an-aside-on-names">An Aside on Names</a></h2>
<p>There's been some debate as to whether Twine produces games or merely stories: the truth is, with Twine you can make games, you can make interactive stories, and you can also make things that nobody can quite pin down. Keeping in the spirit of vexing formalists who prefer clear boundaries, this guide calls the things you'll create with Chapbook <em>stories</em> and the people who you share them with <em>players</em>, but you shouldn't infer anything from this usage. Please make strange things with Twine and Chapbook.</p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>Chapbook, sadly, cannot be used with Twine 1.
<sup class="footnote-reference"><a href="#2">2</a></sup>: If you have programming experience, this idea may immediately cause some alarm--how can you possibly write anything serious without this functionality? <a href="state/conditional-display.html">Conditional Display</a> discusses this subject, but it may be a bit hard to follow if you skip ahead immediately.</p>
</div>
<style>
.patreon-supporters {
		border: 1px solid var(--fg);
		border-radius: 2px;
    padding: 1em;
    margin-bottom: 1em;
}

.patreon-supporters ul {
    list-style-type: none;
    padding-left: 0;
    margin: 0;
}

.patreon-supporters li {
    text-align: center;
}

</style><div style="break-before: page; page-break-before: always;"></div><h1 id="acknowledgments"><a class="header" href="#acknowledgments">Acknowledgments</a></h1>
<p>Chapbook is a confluence of ideas rather than one, wholly original one. Its vars sections are familiar territory to anyone who has used YAML front matter in a static site generator like <a href="https://hexo.io/docs/front-matter.html">Hexo</a>. And much of its state-centered design--in opposition to an imperative design, where change occurs mostly through function calls--comes from what I've learned from <a href="https://redux.js.org">Redux</a>, the de facto standard library for managing state in the <a href="https://reactjs.org">React</a> ecosystem.</p>
<p>You may not be able to tell it by looking at the syntax, but the named hooks of Leon Arnott's <a href="https://twine2.neocities.org">Harlowe story format</a> inspired many of the thoughts that Chapbook is based upon. What I found so appealing about named hooks is the idea of keeping code separate from the text it affects; that logic could be kept, if only at arm's length, separate from prose.</p>
<p>Chapbook's default aesthetics owe a lot to the style of the interactive fiction engine <a href="http://idmillington.github.io/undum/">Undum</a>, by Ian Millington, as well as Liza Daly's works <em><a href="https://stoneharborgame.com">Stone Harbor</a></em> and <em><a href="https://lizadaly.com/pages/harmonia/">Harmonia</a></em>. I hope you find Chapbook's appearance half as graceful as these examples. Or if not--I hope I've left you enough hooks to customize it away into something better.</p>
<p>The notes feature of Chapbook's backstage view was inspired by <a href="http://www.maximumverbosity.net/twine/Illume/">Illume</a>, which is an excellent way to review a Twine story before release.</p>
<p>If you take a look at the <a href="https://twinery.org/cookbook/">Twine Cookbook</a>, you’ll see more than a few similarities between its table of contents and this guide's. This is no accident. One of my design goals with Chapbook was to make common use cases easy--and the Twine Cookbook has been a wonderful signpost as to what people wanted to achieve with Twine.</p>
<p>You might also notice some resemblance between this guide and the <a href="https://inform-fiction.org/manual/">Inform Designer's Manual</a>, written by Graham Nelson, which not only is one of my favorite works of technical writing, but is possibly the one document that's most responsible for my ongoing infatuation with interactive fiction.</p>
<p>Finally, I want to thank my creative partner Joel Haddock for patiently playing the roles of guinea pig and sounding board in equal measure.</p>
<h2 id="photos-in-this-guide"><a class="header" href="#photos-in-this-guide">Photos in this Guide</a></h2>
<p>The photos found in this guide come from a combination of <a href="https://pixabay.com">Pixabay</a> and <a href="https://unplash.com">Unsplash</a>, and are used under terms of the licenses on those web sites. The people who took these photos are:</p>
<ul>
<li><a href="https://pixabay.com/en/chess-game-board-chess-game-1403622/">Angela Bedürftig</a></li>
<li><a href="https://pixabay.com/en/battleship-engine-room-historic-war-389274/">Gregory Butler</a></li>
<li><a href="https://unsplash.com/photos/R2aodqJn3b8">Lauren Fleishmann</a></li>
<li><a href="https://pixabay.com/en/letters-numbers-blocks-alphabet-691842/">Free-Photos</a></li>
<li><a href="https://unsplash.com/photos/9BoqXzEeQqM">Tom Hermans</a></li>
<li><a href="https://unsplash.com/photos/pLwh3AI1zKE">Jason Leung</a></li>
<li><a href="https://pixabay.com/zh/%E6%A3%AE%E6%9E%97-%E8%87%AA%E7%84%B6-%E6%88%B7%E5%A4%96-%E8%B7%AF%E5%BE%84-%E6%A0%91-%E4%BC%8D%E5%85%B9-1868028/">Pexels</a></li>
<li><a href="https://pixabay.com/en/chain-chains-iron-hard-metal-link-109302/">Uriel Shuraki</a></li>
<li><a href="https://pixabay.com/en/mic-microphone-sound-check-sing-1132528/">Rudy and Peter Skitterians</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><div class="intro links">
    <h1 id="text-and-links"><a class="header" href="#text-and-links">Text and Links</a></h1>
</div>
<p>This section begins with an explanation of how to add text formatting, such as boldface or small caps, to text in your story, and create links between passages. Once you've finished it, you'll be able to create the digital equivalent of books like the <em>Choose Your Own Adventure</em> series.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="text-formatting"><a class="header" href="#text-formatting">Text Formatting</a></h1>
<p>Of course, you can type paragraphs into a Twine passage in Chapbook and it will display them as you would expect. But for other kinds of formatting, such as bold or italics, Chapbook follows the syntax of a popular markup language called <a href="https://daringfireball.net/markdown">Markdown</a>.</p>
<p>The term 'markup language' might sound complex, but in reality it's just a set of conventions of how to represent formatting in plain text. For example, to make part of your text italicized when displayed, you simply type asterisks around it, <code>*like so*</code>.</p>
<p>If you've never used Markdown before, try using the <a href="https://daringfireball.net/projects/markdown/dingus">dingus</a> as you read this section. It's an online playground with a funny name that not only allows you to quickly see how text will be rendered, but also has a cheatsheet that summarizes the different formatting available to you. Bear in mind, however, that Chapbook has a few extra formatting options available to you above and beyond the standard Markdown set.</p>
<h2 id="italics-and-boldface"><a class="header" href="#italics-and-boldface">Italics and Boldface</a></h2>
<p>To italicize a a phrase, type <code>*</code> or <code>_</code> (a single underscore)<sup class="footnote-reference"><a href="#1">1</a></sup> around it.</p>
<div class="table-wrapper"><table><thead><tr><th>Typed</th><th>Displayed</th></tr></thead><tbody>
<tr><td><code>_Unconventional_ tastes</code></td><td><em>Unconventional</em> tastes</td></tr>
<tr><td><code>*Unconventional* tastes</code></td><td><em>Unconventional</em> tastes</td></tr>
</tbody></table>
</div>
<p>To make a phrase boldface, type <code>**</code> or <code>__</code> (two underscores) around it.</p>
<div class="table-wrapper"><table><thead><tr><th>Typed</th><th>Displayed</th></tr></thead><tbody>
<tr><td><code>__Unconventional__ tastes</code></td><td><strong>Unconventional</strong> tastes</td></tr>
<tr><td><code>**Unconventional** tastes</code></td><td><strong>Unconventional</strong> tastes</td></tr>
</tbody></table>
</div>
<p>It doesn't matter whether you use asterisks or underscores, so long as you're consistent in a single usage, and you can mix and match them in your text.</p>
<div class="table-wrapper"><table><thead><tr><th>Typed</th><th>Displayed</th></tr></thead><tbody>
<tr><td><code>**&quot;I'll _murder_ you,&quot;** she hissed.</code></td><td><strong>&quot;I'll <em>murder</em> you,&quot;</strong> she hissed.</td></tr>
</tbody></table>
</div>
<h2 id="monospaced-type"><a class="header" href="#monospaced-type">Monospaced Type</a></h2>
<p>To set text in a monospaced typeface, <code>like this</code>, type backticks (<code>`</code>) around it.</p>
<div class="table-wrapper"><table><thead><tr><th>Typed</th><th>Displayed</th></tr></thead><tbody>
<tr><td><code>`Beep boop,` HAL commented.</code></td><td><code>Beep boop,</code> HAL commented.</td></tr>
</tbody></table>
</div>
<h2 id="small-caps"><a class="header" href="#small-caps">Small Caps</a></h2>
<p>If you'd like to set some text in small caps, type <code>~~</code> (two tildes) around it.</p>
<div class="table-wrapper"><table><thead><tr><th>Typed</th><th>Displayed</th></tr></thead><tbody>
<tr><td><code>Above the door was a ~~NO TRESPASSING~~ sign.</code></td><td>Above the door was a <span style="font-size: 70%; text-transform: uppercase; letter-spacing: 0.08em">NO TRESPASSING</span> sign.</td></tr>
</tbody></table>
</div>
<p>This convention, though not a part of original recipe Markdown, conflicts with some other Markdown dialects, which use <code>~~</code> for struck-out text, <del>like so</del>. To do this, type <code>&lt;del&gt;</code> and <code>&lt;/del&gt;</code> around your text:</p>
<div class="table-wrapper"><table><thead><tr><th>Typed</th><th>Displayed</th></tr></thead><tbody>
<tr><td><code>At the bottom of the page, nearly completely covered by the government censor's pen, was that same code name you had seen before: &lt;del&gt;S-5900&lt;/del&gt;.</code></td><td>At the bottom of the page, nearly completely covered by the government censor's pen, was that same code name you had seen before: <del>S-5900</del>.</td></tr>
</tbody></table>
</div>
<h2 id="line-breaks"><a class="header" href="#line-breaks">Line Breaks</a></h2>
<p>If you'd like to insert a single line break, leave two spaces at the end of a line, or put a backslash (<code>\</code>) at the end of a line.</p>
<table>
	<thead><tr><th>Typed</th><th>Displayed</th></tr></thead>
	<tbody>
	<tr><td><code>After the final no there comes a yes \</code><br><code>And on that yes the future world depends.</code></td><td>After the final no there comes a yes<br>And on that yes the future world depends.</td></tr>
	</tbody>
</table>
<h2 id="section-breaks"><a class="header" href="#section-breaks">Section Breaks</a></h2>
<p>A convention sometimes used in publishing to indicate a new scene, or a new line of thought is to separate the text using a series of asterisks, like this:</p>
<blockquote>
<p>It had been a long day, and I fell asleep nearly instantly.</p>
<p style="text-align: center">* &nbsp; * &nbsp; *</p>
The following morning was no better than the day before.
</blockquote>
<p>To add a section break to your text, type <code>***</code> (three asterisks) on a line by itself.</p>
<h2 id="lists"><a class="header" href="#lists">Lists</a></h2>
<p>To created a bulleted list (or, in the parlance of the web, an unordered list), type <code>*</code>, <code>-</code>, or <code>+</code> at the beginning of a new line. It doesn't matter which character you use, but you do need to be consistent in each list.</p>
<table>
	<thead><tr><th>Typed</th><th>Displayed</th></tr></thead>
	<tbody>
	<tr><td><code>* Red</code><br><code>* Green</code><br><code>* Blue</code></td><td><ul><li>Red</li><li>Green</li><li>Blue</li></ul></td></tr>
	</tbody>
</table>
<p>To create a numbered list (also known as an ordered list), start each line either with a number and a period, or just a <code>#</code>. The numbering you use doesn't actually matter--you can have two items starting with <code>2.</code> and the list will still be numbered correctly.</p>
<table>
	<thead><tr><th>Typed</th><th>Displayed</th></tr></thead>
	<tbody>
	<tr><td><code># Red</code><br><code># Green</code><br><code># Blue</code></td><td><ol><li>Red</li><li>Green</li><li>Blue</li></ol></td></tr>
	<tr><td><code>1. Red</code><br><code>2. Green</code><br><code>3. Blue</code></td><td><ol><li>Red</li><li>Green</li><li>Blue</li></ol></td></tr>
	</tbody>
</table>
<p>Why bother to specially format a numbered list? Just like in word processors, using this format will cause each item to be nicely indented, so that the second line of text of each item appears to the right of the initial number.</p>
<h2 id="ignoring-formatting-characters"><a class="header" href="#ignoring-formatting-characters">Ignoring Formatting Characters</a></h2>
<p>Occasionally you'll want to use Markdown formatting characters as-is, without them initiating formatting. The simplest way to do this is to put a <code>\</code> (backslash) in front of them.</p>
<div class="table-wrapper"><table><thead><tr><th>Typed</th><th>Displayed</th></tr></thead><tbody>
<tr><td><code>\*\* PLEASE EXIT NOW \*\*</code></td><td>** PLEASE EXIT NOW **</td></tr>
</tbody></table>
</div>
<h2 id="other-custom-styling"><a class="header" href="#other-custom-styling">Other Custom Styling</a></h2>
<p>You can also enter HTML into a passage without any extra code surrounding it. It will be displayed exactly as you type it in. The library that Chapbook uses to render Markdown is sometimes inconsistent about how it treats HTML, however. It will always let HTML tags pass through as-is, but whether it interprets the contents of these tags as Markdown or HTML can depend on the exact situation. Unfortunately, the best way to test this is to experiment.</p>
<h2 id="blockquotes-dont-behave-as-you-might-expect"><a class="header" href="#blockquotes-dont-behave-as-you-might-expect">Blockquotes Don't Behave As You Might Expect</a></h2>
<p>Chapbook formatting differs from standard Markdown in how it displays blockquotes--that is, a long stretch of text, often multiple paragraphs, that is indented to indicate it isn't part of the main text. Markdown uses <code>&gt;</code> at the start of a line to indicate this. However, Chapbook uses the <code>&gt;</code> to mark text as part of a <a href="text-and-links/forks.html">fork</a> instead. If you'd like to display a block quotation, put <code>&lt;blockquote&gt;</code> and <code>&lt;/blockquote&gt;</code> around it.</p>
<div class="table-wrapper"><table><thead><tr><th>Typed</th><th>Displayed</th></tr></thead><tbody>
<tr><td><code>&lt;blockquote&gt;Call me Ishmael. Some years ago--never mind how long precisely--having little or no money in my purse, and nothing particular to interest me on shore, I thought I would sail about a little and see the watery part of the world.&lt;/blockquote&gt;</code></td><td><blockquote>Call me Ishmael. Some years ago--never mind how long precisely--having little or no money in my purse, and nothing particular to interest me on shore, I thought I would sail about a little and see the watery part of the world.</blockquote></td></tr>
</tbody></table>
</div>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>Underscores as italics have a tangled history behind them; they resemble underlines, which were more-or-less invented as a workaround for typewriters being unable to italicize words.</p>
</div>
<style>
tr, td {
	width: 50%;
}
</style>
<div style="break-before: page; page-break-before: always;"></div><h1 id="simple-links"><a class="header" href="#simple-links">Simple Links</a></h1>
<p>At the heart of every Twine story are links. Chapbook follows the Twine conventions for typing links, which is to say, it steals shamelessly from the syntax used by wikis everywhere.</p>
<p>The simplest link notation surrounds a name of a passage with double square brackets: <code>[[A tiny door]]</code>. This displays the title of the passage directly in the text.</p>
<p>Sometimes it makes sense to obscure the name of the destination in the text--perhaps because your passage is named <code>A Grisly End</code>, or the title of the passage is capitalized but you'd like to link it in the middle of a sentence. You can do this in two different, but equivalent ways.</p>
<div class="table-wrapper"><table><thead><tr><th>Typed</th><th>Displayed</th></tr></thead><tbody>
<tr><td><code>You [[open the door-&gt;A Grisly End]] with great confidence.</code></td><td>You <a href="javascript:void(0)">open the door</a> with great confidence.</td></tr>
<tr><td><code>The [[Miss Scarlet&lt;-young lady]] seated in the chaise seems inexplicably guilty to you.</code></td><td>The <a href="javascript:void(0)">young lady</a> seated in the chaise seems inexplicably guilty to you.</td></tr>
</tbody></table>
</div>
<p>(The links don't lead anywhere in the examples above, of course.)</p>
<p>The easiest way to remember this is to think of the arrow pointing to the passage you're linking to. It doesn't matter which direction the arrow points; use the syntax that feels most comfortable to you.</p>
<p>You cannot use <a href="text-and-links/text-formatting.html">Markdown or other formatting characters</a> inside a simple link. If you'd like to italicize a certain link, for example, put the formatting around the link instead, i.e. <code>_[[a friend of a friend]]_</code>. See <a href="text-and-links/../modifiers-and-inserts/link-inserts.html">Link Inserts</a> for how to create a link that has formatting inside it, like <a href="javascript:void(0)">a man with <em>particular</em> skills</a>.</p>
<h2 id="external-links"><a class="header" href="#external-links">External Links</a></h2>
<p>To link to another web page, enter a URL instead of a passage name. You can use any link syntax you'd like, though the arrow syntax makes your text more readable in most cases:</p>
<div class="table-wrapper"><table><thead><tr><th>Typed</th><th>Displayed</th></tr></thead><tbody>
<tr><td><code>You [[open Twine-&gt;https://twinery.org]] on your computer.</code></td><td>You <a href="https://twinery.org">open Twine</a> on your computer.</td></tr>
</tbody></table>
</div>
<h2 id="older-link-syntax"><a class="header" href="#older-link-syntax">Older Link Syntax</a></h2>
<p>Chapbook also supports the link syntax from Twine 1 that used a vertical bar (or pipe character):</p>
<table>
<thead>
<tr>
<th>Typed</th>
<th>Displayed</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>You [[open the door|A Grisly End]] with great confidence.</code>
<td>
You <a href="javascript:void(0)">open the door</a> with great confidence.
</td>
</tr>
<tbody>
</table>
<p>This is harder to remember than the arrow syntax, so there's little reason to use it now unless you learned it from Twine 1.</p>
<style>
tr, td {
	width: 50%;
}
</style>
<div style="break-before: page; page-break-before: always;"></div><h1 id="forks"><a class="header" href="#forks">Forks</a></h1>
<p>It's a staple of interactive fiction to show a set of possible choices together, often at the end of a passage. The <em>Choose Your Own Adventure</em> series of books would have text like this at the bottom of a page:</p>
<blockquote>
<p>If you decide to walk along the beach, turn to page 5.</p>
<p>If you decide to climb the rocky hill, turn to page 6.</p>
</blockquote>
<p>We don't need to specify page numbers when working in a digital format, of course, but it can still be nice to set off these choices from the rest of the text. Chapbook calls these bundles of links <em>forks</em>, and they are signalled by placing each link on separate line, with <code>&gt;</code> at its beginning:</p>
<pre><code>&gt; [[Walk along the beach]]
&gt; [[Climb the rocky hall]]
</code></pre>
<p>Forks display light lines between the links and horizontally center the text of the links. See <a href="text-and-links/../customization/fork-style.html">Fork Style</a> to learn how to change this.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ways-to-link"><a class="header" href="#ways-to-link">Ways to Link</a></h1>
<p>The concept of a hyperlink doesn't bear explaining, does it? Can you remember how many hyperlinks you followed to reach this guide after you opened your web browser? We take hyperlinks for granted because they are such a fundamental part of the web, and yet, we're still collectively figuring out all of their uses.</p>
<p>Hypertext is still such a young medium that although the world mostly agrees that there exists categories of links, there isn't yet a consensus on what these categories are, let alone what they should be called.</p>
<p>So, some food for thought.</p>
<ul>
<li>
<p><a href="https://heterogenoustasks.wordpress.com/2015/01/26/standard-patterns-in-choice-based-games/">Standard Patterns in Choice-Based Games</a> analyzes <em>Choose Your Own Adventure</em> books and their descendants and identifies some common ways they branched.</p>
</li>
<li>
<p><a href="http://www.eastgate.com/patterns/Print.html">Patterns of Hypertext</a> does something similar, but instead uses the literary hypertexts of the 1990s as its sources.</p>
</li>
<li>
<p><a href="http://www.deenalarsen.net/fundamentals/links.html">Fun da mentals: Rhetorical Devices for Electronic Literature</a> suggests some exercises to try to broaden your perspective on linking.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introducing-backstage"><a class="header" href="#introducing-backstage">Introducing Backstage</a></h1>
<p>When you launch your story from Twine using the <strong>Test</strong> button in the editor toolbar, Chapbook enables its <em>backstage view</em>: a panel that sits beside your story and allows you to peek into its workings and tinker with them while you interact with it as players will. This section discusses the <strong>History</strong> and <strong>Notes</strong> tabs in the backstage view. The other tabs, <strong>State</strong> and <strong>Style</strong>, are discussed later in this guide in <a href="text-and-links/../state/backstage.html">State Backstage</a> and <a href="text-and-links/../customization/page-style.html">Page Style</a> respectively.</p>
<p>If you would like to temporarily hide the backstage view, use the arrow button to its left, which toggles the view's visibility.</p>
<p>{% hint %}
While testing your story in Twine, it's best to use the <strong>Test</strong> button instead of <strong>Play</strong>. If you use the <strong>Play</strong> button instead, Chapbook will try to resume play where you last left off. Usually, you'd like to start from the beginning, which Chapbook does in test mode.
{% endhint %}</p>
<h2 id="the-history-tab"><a class="header" href="#the-history-tab">The History Tab</a></h2>
<p>As you visit passages in your story, the History tab will show them in a tabular list, with the oldest at the top and the most recent at the bottom.</p>
<p>You may see some additional rows next to each passage name. These are explained in <a href="text-and-links/../state/backstage.html">State Backstage</a>, but for now you can ignore them.</p>
<p>Use the ↳ button beside an entry in the table to rewind the story to that passage.</p>
<h2 id="the-notes-tab"><a class="header" href="#the-notes-tab">The Notes Tab</a></h2>
<p>This tab can be used to record notes on the passage you're currently viewing--noting misspellings, or any other thoughts you'd like to record. These notes are stored separately from the story itself, so that if you are collaborating with other people on a story, each of you can keep separate notes. The notes you enter are saved automatically as you type.</p>
<p>You can export notes you've entered using the <strong>Export Notes</strong> button, and import them into someone else's browser using the <strong>Import Notes</strong> button. If any notes already exist for a passage, the notes you import will appear below what was previously entered. If you'd like to reset your notes, use the <strong>Delete All Notes</strong> button.</p>
<div style="break-before: page; page-break-before: always;"></div><div class="intro modifiers-inserts">
    <h1 id="modifiers-and-inserts"><a class="header" href="#modifiers-and-inserts">Modifiers and Inserts</a></h1>
</div>
<p>This section introduces the two ways Chapbook allows you to create more elaborate in your passages, modifiers and inserts. If you are familiar with macros in other story formats, they work in a similar kind of way.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="modifiers-and-text-alignment"><a class="header" href="#modifiers-and-text-alignment">Modifiers and Text Alignment</a></h1>
<p>One thing not mentioned in the previous section is how you would center text, or even right-align it. Alignment was never part of the original version of Markdown, and so various dialects of Markdown use their own notation for it.<sup class="footnote-reference"><a href="#1">1</a></sup></p>
<p>Chapbook uses a general-purpose notation called a <em>modifier</em> to apply special handling to blocks of text. Modifiers are always single lines that begin and end with square brackets<sup class="footnote-reference"><a href="#2">2</a></sup>, like so:</p>
<pre><code>Above the cave mouth, someone has carved:

[align center]
_Lasciate ogne speranza, voi ch'intrate_
</code></pre>
<p>The text <code>[align center]</code> is never shown to the player. Instead, Chapbook centers the text following it. As you might have guessed, you can also write <code>[align right]</code> and <code>[align left]</code>.</p>
<h2 id="the-continue-modifier"><a class="header" href="#the-continue-modifier">The <code>continue</code> modifier</a></h2>
<p>Modifiers apply to all the text that follow them, until either the end of the passage or another modifier appears in the source text. To cancel all active modifiers, use <code>[continue]</code> like so:</p>
<pre><code>Above the cave mouth, someone has carved:

[align center]
_Lasciate ogne speranza, voi ch'intrate_

[continue]
You feel a little less confident in your plan.
</code></pre>
<p><code>[continue]</code> simply cancels all active modifiers. You can abbreviate it as <code>[cont'd]</code> or <code>[cont]</code>.</p>
<h2 id="vertical-text-alignment"><a class="header" href="#vertical-text-alignment">Vertical text alignment</a></h2>
<p>If you'd like to change how text is aligned vertically inside the page
container, see the <a href="modifiers-and-inserts/../customization/page-style.html">Page Style</a> section.</p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>Twine 2's default format, Harlowe, for instance, uses punctuation like <code>=&gt;&lt;=</code> on the preceding line to indicate centered text, while other Markdown dialects put arrows around centered text, like <code>-&gt;SALE TODAY&lt;-</code>.
<sup class="footnote-reference"><a href="#2">2</a></sup>: If you'd like to show players a line of text with brackets in it, enter a single backslash (<code>\</code>) at the start of the line. Chapbook will display the text as-is without the backslash you entered.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="delayed-text"><a class="header" href="#delayed-text">Delayed Text</a></h1>
<p>You can also use a modifier to cause part of the text of a passage to appear after a delay. If you've never seen this effect before, take a look at the introduction to Stephen Granade's <em><a href="http://ifarchive.org/if-archive/games/competition2017/Will%20Not%20Let%20Me%20Go/Will%20Not%20Let%20Me%20Go.html">Will Not Let Me Go</a></em>. The sentences fade in and out, leaving you with a single word, &quot;remember.&quot; Although that story wasn't built with Chapbook, you can use Chapbook's delayed text functionality to achieve the same effect.</p>
<p>Here's an example of this modifier in action:</p>
<pre><code>You settle in for the long transatlantic flight.

[after 1 second]
You remember suddenly that you left the stove on at home.
</code></pre>
<p>The text <code>[after 1s]</code> is never shown to the player. Instead, Chapbook displays <code>You remember suddenly that you left the stove on at home.</code> after the previous text has been onscreen for one second.</p>
<p>You can put any measurement of time you want in the <code>after</code> modifier<sup class="footnote-reference"><a href="#1">1</a></sup>, and you can abbreviate the units of time. The below are all valid:</p>
<pre><code>[after 300 milliseconds]
[after 300ms]
[after 1 minute]
</code></pre>
<p>The <code>after</code> modifier only allows round numbers. Instead of writing <code>1.5 seconds</code>, you must write <code>1 second 500 milliseconds</code>, or shorter: <code>1s500ms</code> or <code>1500ms</code>.</p>
<h2 id="advice-on-using-after"><a class="header" href="#advice-on-using-after">Advice on Using <code>after</code></a></h2>
<p>The <code>after</code> modifier should be used sparingly, and the delays should be specified keeping in mind that everyone reads a different pace. One minute may not seem very long, but it's an eternity for fast players.</p>
<p>Chapbook signals that more text will be coming by displaying an animated watch in the lower-right corner of the page, and impatient players can click the mouse or press a key to skip over the delay. This functionality cannot be disabled.</p>
<h2 id="modifiers-normally-create-paragraphs"><a class="header" href="#modifiers-normally-create-paragraphs">Modifiers Normally Create Paragraphs</a></h2>
<p>Modifiers normally cause the text that follows them to be in a separate paragraph from the text before it. There are cases, though, where you want text to appear with the preceding paragraph instead. The <code>append</code> modifier makes this happen.</p>
<pre><code>You've solved the mystery at last.

[after 500ms; append]
But then it hits you: why _did_ Mrs. Peacock have a lead pipe in her purse?
</code></pre>
<p>The semicolon allows you to join multiple modifiers together in a single line. It's equivalent to:</p>
<pre><code>[after 500ms]
[append]
But then it hits you: why _did_ Mrs. Peacock have a lead pipe in her purse?
</code></pre>
<p>It doesn't matter which order you put <code>append</code>, and unlike <code>after</code>, you enter it by itself, without any extra explanation.</p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>Including, fiendishly, days, months, and years. Chapbook uses a library called <code>timestring</code> to parse these delays. <a href="https://github.com/mike182uk/timestring/blob/master/README.md#keywords">Its documentation</a> lists out all of the possibilities.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="notes"><a class="header" href="#notes">Notes</a></h1>
<p>You may want to enter text in your story as a note to yourself as you work--for example, to note that a passage needs some revision, clarify how players could reach a passage, or just remind yourself where to pick up in your next editing session.</p>
<p>To do this, use the <code>[note]</code> modifier.</p>
<pre><code>It was a dark and stormy night.

[note]
I really need a better beginning.
</code></pre>
<p>When Chapbook displays the passage, it will only show <code>It was a dark and stormy night.</code> You can write <code>[note to myself]</code> or <code>[n.b.]</code><sup class="footnote-reference"><a href="#1">1</a></sup> instead of <code>[note]</code>. You can also write <code>[fixme]</code> and <code>[todo]</code>, which come from the programming world. They work identically to <code>[note]</code>, but you can easily do a search in the Twine editor for these terms to make sure you've addressed everything before a release. <code>[todo]</code> is useful for noting things yet to be implemented, while <code>[fixme]</code> is useful for problems you've noticed, but haven't yet had time to fix.</p>
<p>You can, of course, use more than one note in a passage, and mix them with regular text:</p>
<pre><code>It was a dark and stormy night.

[note]
I really need a better beginning.

[todo]
Maybe have the screen flash?

[continue]
And you felt quite depressed.
</code></pre>
<p>These notes are stored separately from what is entered in the <a href="modifiers-and-inserts/../text-and-links/backstage.html">Notes backstage tab</a>, unfortunately.</p>
<p>{% hint style=&quot;danger&quot; %}
Unlike backstage comments, notes are still visible to anyone who knows how to use their web browser's development tools. Don't put anything you need to keep secret in a note.
{% endhint %}</p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>Short for <em>nota bene</em>, which is a fancy way to write <em>pay attention to this</em>.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="link-inserts"><a class="header" href="#link-inserts">Link Inserts</a></h1>
<p>Sometimes you'd like to link to a passage, but don't know its name exactly. Take the passage below:</p>
<pre><code>You walk a bit down the alleyway. The scent of the black trash bags simmering in the summer heat is overpowering--terrible in three separate yet indescribable ways--so you [[retreat for now]].
</code></pre>
<p>All well and good, except that alleyways often have two entrances. If a player could reach this passage two different ways, how can you make sure they return to the right place? You can use an <em>insert</em> to do this. Inserts are special instructions in passage text that are framed with curly brackets, <code>{like this}</code>, and are interpreted instead of displayed verbatim. They're called inserts because they instruct Chapbook to insert something into the text for you. In this case, we want Chapbook to insert a link to whatever passage the player was looking at before they reached this one.</p>
<p>In this case, we'd write:</p>
<pre><code>You walk a bit down the alleyway. The scent of the black trash bags simmering in the summer heat is overpowering--terrible in three separate yet indescribable ways--so you {back link, label: 'retreat for now'}.
</code></pre>
<p>Inserts follow this format:</p>
<p class="insert-example">
	<span class="punc">{</span>
	<span class="identifier">insert name</span>
	<span class="punc">:</span>
	<span class="direct-object">value</span>
	<span class="punc">,</span>
	<span class="param1">
		<span class="param-name">parameter name</span>
		<span class="punc">:</span>
		<span class="param-value">value</span>
	</span>
	<span class="punc">,</span>
	<span class="param2">
		<span class="param-name">parameter name</span>
		<span class="punc">:</span>
		<span class="param-value">value</span>
	</span>
	<span class="punc">}</span>
</p>
<ul>
<li>The <em>insert name</em> signals what type of insert this is, i.e. <code>back link</code>.</li>
<li><em>Parameter names</em> signal more specific descriptions of how the insert should
appear or behave, i.e. <code>label</code>. Each kind of insert accepts different
parameter names. Parameter names, unlike values, never have quotation marks
around them. An insert can have any number of parameters, including none.
Two are shown in the example above to demonstrate that they are divided by
commas.</li>
<li><em>Values</em> are where you specify the behavior of the insert. If a parameter
value is text--like the words <code>'retreat for now'</code>--they must have either
single or double quotation marks around them, so that Chapbook knows where
the beginning and end of the text is. There's no difference in how single or
double quotation marks are handled; it's just convenient to write <code>{back link, label: 'Exclaim, &quot;Well, I never!&quot;'}</code>.<sup class="footnote-reference"><a href="#1">1</a></sup> Any other types of values,
such as numbers, must not have quotation marks around them. </li>
</ul>
<p>An insert must have its contents all on one line--no line breaks with the Enter or Return key are permitted.</p>
<p>Everything in the example above is optional except the insert name. Different inserts use different variations of this usage--for instance, the <code>back link</code> insert does not use a value following the insert name:</p>
<p class="insert-example">
	<span class="punc">{</span>
	<span class="identifier">back link</span>
	<span class="punc">,</span>
	<span class="param1">
		<span class="param-name">label</span>
		<span class="punc">:</span>
		<span class="param-value">'retreat for now'</span>
	</span>
	<span class="punc">}</span>
</p>
<p>You can also leave off the <code>label</code> property and just write <code>{back link}</code>: in this case, Chapbook will assume you'd like it to use the word 'Back' as the link label.</p>
<p>If Chapbook is unable to understand the contents of an insert, it displays it as-is. This is so that you can otherwise use curly brackets in your text.</p>
<p>{% hint style='danger' %}
You cannot nest inserts inside each other.
{% endhint %}</p>
<h2 id="restarting-the-story"><a class="header" href="#restarting-the-story">Restarting the Story</a></h2>
<p>There's another insert very similar to <code>{back link}</code> that's named <code>{restart link}</code>. Instead of going to a previous passage, it takes the player back to the very beginning of the story. You could of course link back to the first passage by name, but for now, consider this a handy shortcut. <code>{restart link}</code> also resets other aspects of Chapbook's operation, as you'll learn in <a href="modifiers-and-inserts/../state/continuity.html">Continuity Between Sessions</a>.</p>
<p>As with <code>{back link}</code>, <code>{restart link}</code> allows you to specify a label:</p>
<pre><code>{restart link, label: 'Oh forget it all'}
</code></pre>
<p>If you write <code>{restart link}</code> by itself, Chapbook will use the label 'Restart'.</p>
<h2 id="manual-links"><a class="header" href="#manual-links">Manual Links</a></h2>
<p>You can also insert a link using the insert <code>{link to}</code>. Below are some examples:</p>
<pre><code>You decide after entirely too much deliberation to download {link to: 'https://mozilla.org/firefox', label: 'Firefox'}.

You notice that there is a {link to: 'narrow alleyway'} off to one side.

A {link to: 'Bryan Mills', label: 'A man with *certain* skills'} is just who's needed.
</code></pre>
<p>The third example demonstrates one use of manual link inserts: although they are more verbose than simple links, they do allow you to enter Markdown formatting into the link label. Passage links also have other uses; see <a href="modifiers-and-inserts/../state/the-vars-section.html#expressions-can-be-used-in%20inserts">The Vars Section</a> for how you can change the destination of a link dynamically.</p>
<h2 id="cycling-links"><a class="header" href="#cycling-links">Cycling Links</a></h2>
<p>Chapbook has an insert for cycling links--that is, links that do not move the player anywhere, but change their label. See <a href="modifiers-and-inserts/../player-input/menus-cycling-links.html">Menus and Cycling Links</a> for more information.</p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>If you need to use a single or double quote inside a text value set off with the same punctuation mark, put a backslash (<code>\</code>) in front of it, like so: <code>{back link, label: '&quot;I couldn\'t possibly comment,&quot; he replied.'}</code></p>
</div>
<style>
.insert-example {
	font-size: 120%;
	text-align: center;
	display: flex;
	justify-content: center;
}

.insert-example span {
	display: flex;
}

.insert-example .punc {
	padding: 0 0.2em;
	color: #868e96; /* gray-6 */
	background-color: #f1f3f5; /* gray-1 */
}

.insert-example .identifier {
	padding: 0 0.2em;
	background-color: #ffe3e3; /* red-1 */
}

.insert-example .direct-object, .insert-example .param-value {
	padding: 0 0.2em;
	background-color: #d0ebff; /* blue-1 */
}

.insert-example .param-name {
	padding: 0 0.2em;
	background-color: #ffe8cc; /* orange-1 */
}
</style><div style="break-before: page; page-break-before: always;"></div><h1 id="reveal-links"><a class="header" href="#reveal-links">Reveal Links</a></h1>
<p>A link can also reveal more text in your passage instead of displaying an entirely different one. Liza Daly uses this effect in <em><a href="https://stoneharborgame.com/">Stone Harbor</a></em> (a story she created using another authoring system called <a href="https://github.com/lizadaly/windrift">Windrift</a>) to give the story a novelistic feel.</p>
<p>Chapbook calls these <em>reveal links</em>, and they can either display more text or the contents of an entire passage.</p>
<p>To display more text, write:</p>
<pre><code>I was driving home late one night when {reveal link: 'something odd occurred', text: 'I saw five deer staring at me from one side of the road, all in a line'}.
</code></pre>
<p>This will first display &quot;I was driving home late one night when something odd occurred,&quot; and then when the player selected &quot;something odd occurred,&quot; it will change to &quot;I was driving home late one night when I saw five deer staring at me from one side of the road, all in a line.&quot;</p>
<p>The text you enter in either part of the insert will be interpreted as source code, so you can use <a href="modifiers-and-inserts/../text-and-links/text-formatting.html">formatting</a> to further customize its appearance.</p>
<p>Revealing text works well for short substitutions, but writing long stretches of text can be awkward. In these instances, try revealing a passage:</p>
<pre><code>I was driving home late one night when {reveal link: 'something odd occurred', passage: 'A Dangerous Incident'}.
</code></pre>
<p>This will work the same way as the previous example, only it will show the contents of the passage named 'A Dangerous Incident'.</p>
<p>{% hint style='info' %}
A passage shown by a reveal link will not be recorded in a session's history.
{% endhint %}</p>
<p>When using a reveal link with a passage containing multiple paragraphs, Chapbook inserts the paragraphs in such a way that the surrounding text's order is maintained.</p>
<p>For example, if you have a passage named 'Shopping List':</p>
<pre><code>Apples

Bananas

Carrots
</code></pre>
<p>and then a passage with this:</p>
<pre><code>I went to buy {reveal link: 'groceries', passage: 'Shopping List'}. It was a rainy day.
</code></pre>
<p>The player will see this after they click the link:</p>
<blockquote>
<p>I went to buy Apples</p>
<p>Bananas</p>
<p>Carrots. It was a rainy day.</p>
</blockquote>
<p>Notice how the period after the link insert is moved to the end, after Carrots, but not on a line by itself, and the rest of the paragraph continues.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="embedding-passages"><a class="header" href="#embedding-passages">Embedding Passages</a></h1>
<p>A common need in branching narrative is for divergent paths to merge together. The easiest way to make this happen is for the two passages to link to the same one, but you can also create a less obvious stitch in your story by embedding one passage inside another.</p>
<p>For example, imagine that the main character takes either a plane or train on the way to a passage named &quot;L.A.&quot;:</p>
<pre><code>You spend a few hours watching the clouds drift below the wings of the plane before arriving in [[L.A.]]
</code></pre>
<pre><code>The cross-country train ride leaves plenty of space for contemplation on the way to [[L.A.]]
</code></pre>
<p>You could instead merge the passages directly, using the <code>{embed passage}</code> insert:</p>
<pre><code>You spend a few hours watching the clouds drift below the wings of the plane.

{embed passage: 'L.A.'}
</code></pre>
<pre><code>The cross-country train ride leaves plenty of space for contemplation.

{embed passage: 'L.A.'}
</code></pre>
<p>The two passages will show the contents of the &quot;L.A.&quot; passage below their text. Apart from the passage name, the <code>embed passage</code> insert does not accept any other parameters.</p>
<p>Remember that like any insert, <code>{embed passage}</code> can be placed at any point in the text of a passage. It can be sandwiched between text in a passage, or even repeatedly used.</p>
<div style="break-before: page; page-break-before: always;"></div><div class="intro state">
    <h1 id="state"><a class="header" href="#state">State</a></h1>
</div>
<p>In this section, you'll learn how to add state to your stories, which allows you to track more information about a playthrough of your story than just what links the player followed.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="what-is-state"><a class="header" href="#what-is-state">What is State?</a></h1>
<p>You can create a compelling story with just the techniques outlined in the previous section. The <a href="https://en.wikipedia.org/wiki/Choose_Your_Own_Adventure"><em>Choose Your Own Adventure</em> book series</a> that has been part of Western pop culture since it exploded in popularity in the 1980s did just that. Turning to a particular page in the book is the equivalent of following a link in a digital medium, of course.</p>
<p>But in the wake of <em>CYOA</em>'s popularity came another wave of interactive books written by people familiar with tabletop role-playing games like <em>Dungeons &amp; Dragons</em>.<sup class="footnote-reference"><a href="#1">1</a></sup> They thought the format could be adapted to provide similar experiences to a live RPG session, but without the trouble of having to round up three or four other people to play with. They began to incorporate the trappings of RPGs--in particular, the character sheet.</p>
<p>If you've never seen a character sheet, they resemble a spreadsheet, but instead of a household budget or a corporate profit and loss statement, they describe a character numerically. A very smart D&amp;D character has an intelligence of 17, but an average strength of 7. A character might start with 20 hit points, but after taking a nasty fall into a mountain crevasse only have 8 left.</p>
<p>With character sheets came the concept of <em>state</em>: that is, two readers could reach the same page of a gamebook, but one could be doing very well for themselves, but the other on death's door. The essential quality of state is that it varies between sessions; hence, it contains <em>variables</em>. Variables may be independent (strength and intelligence) or dependent (a weakened character, for example, may be able to carry less weight than usual).</p>
<p>The other popular use of state has been to record whether an event has happened and enable or disable links based on that. The <a href="https://gamebooks.org/Series/389"><em>Sherlock Holmes Solo Mysteries</em></a> series, for example, asks the reader to check Clue A or Clue Q on their character sheet after making a discovery, and then later only allow the protagonist to solve the mystery if they had uncovered all the necessary clues along the way.</p>
<p>Later, the Storyspace hypertext system would incorporate the concept of state with its guard fields. Similar to checking off clues, stories created with Storyspace can choose to show certain links only to players who satisfy the conditions of their guard fields.</p>
<p>The Choice of Games series uses a system well-suited to long narratives that its designers named fairmath. Fairmath averages variable changes so that each time a variable increases or decreases, it does so at a diminishing rate. The effect is similar to the experience-point system of <em>D&amp;D</em>	, where it takes increasingly longer for a skill to improve as a character becomes better at it--although fairmath allows a variable to both increase and decrease, <em>D&amp;D</em> players almost always simply accumulate experience points.</p>
<p>Although state in hypertext may have its roots in the number crunching of RPGs, there's no reason it needs to be so clinical or reductionist.<sup class="footnote-reference"><a href="#2">2</a></sup> Tom McHenry's <a href="https://tommchenry.itch.io/horse-master"><em>Horse Master</em></a> shows a player numerous variables about their horse, including Uncanny and Realness, but it never explains their purpose directly. Porpentine's <a href="http://slimedaughter.com/games/twine/begscape/"><em>Begscape</em></a> uses precious few variables--most apparent to the player are coins and health--but uses them cruelly.</p>
<h2 id="is-state-separate-from-the-players-path"><a class="header" href="#is-state-separate-from-the-players-path">Is State Separate From The Player's Path?</a></h2>
<p>From a certain point of view, though, isn't state simply a side effect of the choices the player makes? That is--do we really need to record anything but what links the player followed? If the outcome of a story hinges on whether the player found Clue M, then surely all we really need to track is what passages they visited. There's no need for this extra bookkeeping.</p>
<p>There are two reasons to record state separately: first, for convenience's sake. It's tedious to type out the code equivalent of &quot;if the player has visited this passage but not this other one&quot; or &quot;if the player has visited any one of these four passages&quot; repeatedly. Secondly, a story might incorporate elements of randomness, such that multiple playthroughs following the same links may yield different results.<sup class="footnote-reference"><a href="#3">3</a></sup></p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p><a href="https://www.librarything.com/work/15900828"><em>You Are The Hero</em></a>, a retrospective of the <em>Fighting Fantasy</em> book series, offers an intriguing peek into the history of one of these RPG-influenced gamebook series. And if you've never tried the genre, <a href="https://www.projectaon.org/">Project Aon</a> hosts nearly all of the works of Joe Dever, who was perhaps the most prolific RPG gamebook author, in a format that can be played in a web browser for free.</p>
</div>
<div class="footnote-definition" id="2"><sup class="footnote-definition-label">2</sup>
<p>To pick apart just one thing in the <em>D&amp;D</em> paradigm: there are many different types of intelligence, and the concept of assigning numeric scores to intelligence in people has a <a href="https://www.theatlantic.com/national/archive/2013/05/why-people-keep-misunderstanding-the-connection-between-race-and-iq/275876/">dark history</a>.</p>
</div>
<div class="footnote-definition" id="3"><sup class="footnote-definition-label">3</sup>
<p>For more on incorporating randomness into your story, see <a href="state/randomness.html">Randomness</a>.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-vars-section"><a class="header" href="#the-vars-section">The Vars Section</a></h1>
<p>The primary way that Chapbook allows you to work with state is through <em>vars (short for variables) sections</em>. These sections always come at the beginning of a passage and are separated from normal text by two dashes (<code>--</code>).</p>
<p>To carry forward the example from the previous section, here's how a desperately stereotypical dungeon crawl's first passage might look:</p>
<pre><code>strength: 18
dexterity: 7
constitution: 14
intelligence: 9
wisdom: 8
charisma: 11
--
After a lusty evening in the village tavern, you set off down the trail to
the nearest dungeon. It's a bright, sunny day, and you're happy to have a
clear destination in mind.
</code></pre>
<p>When the player visits this passage, Chapbook will add six variables to the story's state: <code>strength</code>, <code>dexterity</code>, <code>constitution</code>, and so on, and sets them to the numbers listed.</p>
<p>Vars sections never display anything to the player; this is so that, for example, you can set a variable named <code>doomedToDieInFiveMinutes</code> and the player will be none the wiser unless you wish it.</p>
<p>{% hint style='info' %}
If a passage is embedded in another using the <code>{embed passage}</code> modifier, its vars section will also take effect.
{% endhint %}</p>
<p>You may only have one vars section in each passage, but then there's really only ever need for one. The name of state variables must follow a few rules, too. They must start with a letter (upper or lowercase), underscore (<code>_</code>), or dollar sign (<code>$</code>); after the first character can come any combination of the preceding kinds of characters as well as digits.<sup class="footnote-reference"><a href="#1">1</a></sup></p>
<p>Sadly, you can't use spaces in your variable names. Because of this, a common practice called <em>camel casing</em> (because of the camel-like humps in the resulting word) glues phrases together using capital letters, like the <code>doomedToDieInFiveMinutes</code> example above. Another school of thought, <em>snake casing</em>, prefers to use underscores instead; e.g. <code>doomed_to_die_in_five_minutes</code>. Either's perfectly fine. Use whichever feels most comfortable to you.</p>
<p>Another common practice is to put an underscore in front of variable names when the value will only be used in the current passage. This practice is just a hint to yourself; Chapbook does not enforce this usage.<sup class="footnote-reference"><a href="#2">2</a></sup></p>
<p>{% hint style='info' %}
A variable name can contain periods (<code>.</code>), but they carry a special meaning. Until you've read <a href="state/objects-and-lookups.html">Objects and Lookup Values</a>, it's best to leave them out of variable names.
{% endhint %}</p>
<p>{% hint style='danger' %}
Chapbook and web browsers reserve certain variable names for their own use. If you try to use a variable whose name overlaps them, unpredictable things may happen, so you should avoid them. Chapbook reserves the following names:</p>
<ul>
<li><code>browser</code></li>
<li><code>engine</code></li>
<li><code>now</code></li>
<li><code>passage</code></li>
<li><code>random</code></li>
<li><code>story</code></li>
</ul>
<p>The browser reserves quite a few (over two hundred at time of writing), but you're unlikely to want to use most of them, like <code>ondeviceorientation</code>. See <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window#Properties">the exhaustive list</a> for more details.
{% endhint %}</p>
<p>The only time variable names are shown to a player is if an error occurs in your story while they are playing it, so choose names that are easy to remember and descriptive. There's no need for a <code>clueF</code> variable when you can have <code>sawFootprintsInVault</code> instead.</p>
<h2 id="variables-have-types"><a class="header" href="#variables-have-types">Variables Have Types</a></h2>
<p>The example at the start of this section assigned numbers to variables, but variables can hold other types of values.</p>
<p><em>Strings</em> are collections of letters, numbers, spaces, and other symbols. Strings are surrounded by either apostrophes (<code>'</code>) or quotation marks (<code>&quot;</code>) so that's it clear where they begin and end, in the same way that is used for textual parameter values. You can use either punctuation mark to mark off a string's beginning and end, but just like Markdown italics and bold, you have to be consistent with each usage. If you need to use a delimiter character inside a string, type a backslash (<code>\</code>) in front of it, e.g. <code>'Don\'t, just don\'t.'</code>.</p>
<p>Strings are great for storing names for things. For example, if you want to allow the player to set the name of the main character at the start of a story, a string would be the best type of variable to use. You can also use strings to store fuzzy kinds of values. You could record the state of a relationship between two characters as <code>'friendly'</code>, <code>'neutral'</code>, <code>'wary'</code>, or <code>'hostile'</code>.</p>
<p><em>Booleans</em> simply record a true or false value. Like numbers, you don't need to put anything around a boolean to signal what it is; just type <code>true</code> or <code>false</code>. Booleans are good for recording whether something has occurred in a story; for example, whether the main character has found a clue.</p>
<p>There are other, more complex types of values that will be discussed later, but numbers, strings, and booleans will get you quite far. To review, here's an example of a passage whose vars section contains all three types of variables.</p>
<pre><code>dollarsInPocket: 12
openedPortalToAlternateDimension: true
name: 'James'
--
You've nearly reached the end of your adventure.
</code></pre>
<h2 id="variables-can-be-calculated"><a class="header" href="#variables-can-be-calculated">Variables Can Be Calculated</a></h2>
<p>You don't have to set variables to plain values--meaning, a vars section could look like this when the main character finds a dollar lying on the ground:</p>
<pre><code>dollarsInPocket: dollarsInPocket + 1
</code></pre>
<p>This vars section increases the <code>dollarsInPocket</code> variable by 1 using an <em>expression</em>. You can think of an expression as a formula or calculation. It's anything that can be transformed into a single value via the <em>evaluation</em> process. For example, you can use the basic mathematical operations--addition, subtraction, multiplication, and division--with numeric variables. You can also use addition to connect two strings together--for instance, <code>fullName: first + ' ' + last</code>--but you cannot use any other mathematical operators with strings.</p>
<p>You can also compare two numbers or strings, yielding a boolean.</p>
<ul>
<li>
<p><code>===</code>, &quot;equal to&quot;<br />
True if both sides are the same number or string. Strings have to be exactly the same: <code>'DOE'</code> does not equal <code>'doe'</code>, nor does <code>'doe '</code> (note the trailing space) equal <code>'doe'</code>.</p>
</li>
<li>
<p><code>!==</code>, &quot;not equal to&quot;<br />
True if both sides aren't the same.</p>
</li>
<li>
<p><code>&gt;</code>, &quot;greater than,&quot; and <code>&gt;=</code>, &quot;greater than or equal to&quot;<br />
True if the left side is larger than the right side. If you use <code>&gt;=</code>, then this is also true when the two sides are equal.</p>
</li>
<li>
<p><code>&lt;</code>, &quot;less than,&quot; and <code>&lt;=</code>, &quot;less than or equal to&quot;<br />
True if the left side is smaller than the right side. If you use <code>&lt;=</code>, then this is also true when the two sides are equal.</p>
</li>
</ul>
<p>Generally speaking, one string is considered larger than another if it would come after it in alphabetical order. For example, <code>'b' &gt; 'a'</code>. But these comparisons can be confusing and unintuitive. Is <code>'+'</code> greater than <code>'&amp;'</code>? It in fact is, but would you know at a glance? It might surprise you to learn than <code>'A' &lt; 'a'</code>.<sup class="footnote-reference"><a href="#3">3</a></sup> So it is usually best not to use greater-than or less-than operators with strings.</p>
<p>Below is an example vars section that demonstrates how these can be used.</p>
<pre><code>correct: guess === 3
nighttime: hour &gt;= 18
--
The quizmaster leans back in his chair and grins.
</code></pre>
<p>Boolean variables have their own separate set of operators.</p>
<ul>
<li>
<p><code>!</code>, &quot;not&quot;<br />
Changes a true value to false and vice versa.</p>
</li>
<li>
<p><code>&amp;&amp;</code>, &quot;and&quot;<br />
True only if both sides are true.</p>
</li>
<li>
<p><code>||</code>, &quot;or&quot;<br />
True if one or both sides are true.</p>
</li>
</ul>
<p>{% hint style='danger' %}
You cannot use inserts or modifiers in vars sections. They only work inside the displayed text of your passage.
{% endhint %}</p>
<h2 id="clarifying-expressions-with-parentheses"><a class="header" href="#clarifying-expressions-with-parentheses">Clarifying Expressions With Parentheses</a></h2>
<p>Often expressions are complex. For example, in a simple role-playing scenario, you might decide a character armed with a hammer does <code>strength * 2 + 4</code> damage. But if <code>strength</code> is 12, does that mean that the expression evaluates to 28 (multiply 12 by 2, then add 4) or 72 (add 2 to 4, then multiply by 12)?</p>
<p>You may remember from algebra class that mathematical operators have rules relating to precedence; specifically, multiplication occurs before addition. But you probably have never been taught what the rules are for boolean logic--e.g. what does <code>!true || false</code> evaluate to?<sup class="footnote-reference"><a href="#4">4</a></sup>--and even if you do know the rules, it can be tricky to correctly apply them in a complex expression.</p>
<p>In these situations, you can use parentheses to help make an expression easy to follow, or even to override the normal order of operations. <code>(strength * 2) + 4</code> makes it clear how the expression will be evaluated--and if indeed you wanted the answer above to be 72, you can specify that by writing <code>strength * (2 + 4)</code>.</p>
<h2 id="evaluation-only-happens-once"><a class="header" href="#evaluation-only-happens-once">Evaluation Only Happens Once</a></h2>
<p>An important thing to remember about setting a variable to an expression is that the evaluation only happens once, when you set the variable. Imagine this scenario:</p>
<ol>
<li>In a passage, you set the variable <code>teethChattering</code> to <code>temperature &lt; 0</code>.</li>
<li>In a later passage, the protagonist moves inside and sets <code>temperature: temperature + 20</code>.</li>
</ol>
<p>The variables are now inconsistent: <code>teethChattering</code> is true but <code>temperature</code> is above 0. The best way to avoid this problem is to avoid making a variable completely derived from another. You don't need a separate variable named <code>teethChattering</code> if all it does is reflect whether <code>temperature</code> is greater than 0. A better use would be setting <code>hasACold: temperature &lt; 0 &amp;&amp; !wearingJacket</code>, to reflect that the protagonist caught a cold by being outside without a jacket. They may subsequently go inside or put on a jacket, but obviously neither change will affect the fact that the protagonist <code>hasACold</code>.</p>
<h2 id="expressions-can-be-used-in-inserts"><a class="header" href="#expressions-can-be-used-in-inserts">Expressions Can Be Used in Inserts</a></h2>
<p>An expression can be used in place of a value in an insert. For example, the passage below:</p>
<pre><code>target: 'another passage'
--
{embed passage: target}
</code></pre>
<p>Will display the contents of the passage named 'another passage'. Remember that this usage differs from placing a variable name in quotation marks, which Chapbook treats as a string. That is, this passage:</p>
<pre><code>target: 'another passage'
--
{embed passage: 'target'}
</code></pre>
<p>Shows the contents of the passage named 'target' instead. This can be confusing, of course. The simplest rule to keep in mind is that quotation marks, either single or double, always go around strings. If you don't see quotation marks around something, it will be evaluated.</p>
<p>As the heading advertises, inserts can use entire expressions, not just variables, as values. For instance:</p>
<pre><code>petType: 'cat'
activity: 'Walk'
--
{embed passage: petType + activity}
</code></pre>
<p>Will display the contents of the passage 'catWalk'.</p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>You can use non-Latin characters in variable names, such as <code>sabiduría</code> or <code>мудрость</code>, but bear in mind that older web browsers that do not fully support the Unicode standard--in practice, old versions of Internet Explorer that have miniscule usage rates nowadays--may be deeply confused by them.
<sup class="footnote-reference"><a href="#2">2</a></sup>: The SugarCube story format popularized this practice, and in fact does discard variables whose name starts with an underscore after the player navigates to another passage. 
<sup class="footnote-reference"><a href="#3">3</a></sup>: The final authority on ordering characters in a string is the Unicode standard. Characters are compared by their Unicode code points; a higher numeric code point means that a character is greater than another.
<sup class="footnote-reference"><a href="#4">4</a></sup>: In case you're curious, <code>!true || false</code> evaluates to false. The not operator takes precedent over the or.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="displaying-variables"><a class="header" href="#displaying-variables">Displaying Variables</a></h1>
<p>Of course, setting variables isn't very useful by itself. They need to affect the course of a story somehow. The simplest way they can do this is simply being inserted into the story. You can display the contents of a variable using an insert.</p>
<p>The passage source below:</p>
<pre><code>name: 'Chris'
--
&quot;Hi, {name},&quot; your guide greets you.
</code></pre>
<p>Will display as: <code>&quot;Hi, Chris,&quot; your guide greets you.</code> This example is a little silly, since you could just as easily write <code>Chris</code> where <code><code>name</code></code> is. But the advantage of storing it in a variable is that you could keep using <code><code>name</code></code> later in your story. You could also use this, for example, to allow the player to choose a gender (or lack thereof) and then use the correct pronouns throughout the story.</p>
<p>Variable inserts do not allow any parameters, as introduced in <a href="state/../text-and-links/link-inserts.html">Link Inserts</a>; the name of the variable acts as the insert name.<sup class="footnote-reference"><a href="#1">1</a></sup></p>
<h2 id="you-cannot-put-expressions-in-an-insert"><a class="header" href="#you-cannot-put-expressions-in-an-insert">You Cannot Put Expressions In An Insert</a></h2>
<p>The following will not display as you might expect:</p>
<pre><code>cash: 3
--
&quot;Sorry, but I decided that I want {cash + 2} dollars for it,&quot; the salesman replies.
</code></pre>
<p>Expressions like this are not allowed in variable inserts-- you may only enter the name of a variable. It's simple enough to accomplish this with a temporary variable:</p>
<pre><code>cash: 3
_unreasonablePrice: cash + 3
--
&quot;Sorry, but I decided that I want {_unreasonablePrice} for it,&quot; the salesman replies.
</code></pre>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>You can always distinguish a variable insert from another type of insert by looking for spaces inside it. <code>{back link}</code> could never be a variable insert because <code>back link</code> contains spaces, and thus could never be the name of a variable.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="conditional-display"><a class="header" href="#conditional-display">Conditional Display</a></h1>
<p>The other common use of variables in stories is to block off access to a branch, or conversely unlock a hidden part of a story. In order to do this with Chapbook, you'll need to combine a variable with a modifier.</p>
<p>For instance, let's say you have a passage where the protagonist finds a key hidden in the weeds:</p>
<pre><code>hasKey: true
--
It's the strangest thing: there, in the weeds that surround the base of the tree, is a single rusted key.

After picking it up, you decide to [[move on]].
</code></pre>
<p>Then later in the story, when the protagonist encounters the door the key belongs to:</p>
<pre><code>At the end of the hall, you find a featureless steel door.

[if hasKey]
You could try [[unlocking it]] with the key you found.

[continue]
You consider [[turning back]].
</code></pre>
<p>Only if the player had found the key earlier do they see &quot;You could try unlocking it with the key you found,&quot; but in all cases they see &quot;You consider turning back.&quot; The <code>if</code> modifier only displays the text below it if the expression in the modifier evaluates to true. You can enter anything that eventually evaluates to a boolean<sup class="footnote-reference"><a href="#1">1</a></sup>. Some more examples:</p>
<ul>
<li><code>[if stringVariable === 'red']</code></li>
<li><code>[if dollarsInPocket &gt; 5]</code></li>
<li><code>[if 2 + 2 === 4]</code></li>
</ul>
<h2 id="unless-conditions"><a class="header" href="#unless-conditions">Unless Conditions</a></h2>
<p>In certain cases, it's more expressive to use an <code>unless</code> instead of an <code>if</code>.</p>
<pre><code>[unless tookAntidote]
You've run out of time. Your breath catches in your throat; your body slips from the chair, and the world turns dark.
</code></pre>
<p><code>unless</code> modifiers work exactly the same as <code>if</code> ones, only they display the text following them if their condition evaluates to false.</p>
<h2 id="else-conditions"><a class="header" href="#else-conditions">Else Conditions</a></h2>
<p>The wording of the first example in this section is a bit awkward. We could make it flow better using an <code>else</code> modifier:</p>
<pre><code>[if hasKey]
You could try [[unlocking it]] with the the key you found, or just [[turn back]].

[else]
Nothing to do here but [[turn back]].
</code></pre>
<p><code>else</code> modifiers display the text following them if the previous <code>if</code> did not display. They have no relationship with <code>unless</code> conditions. <code>else</code>s also only apply on a per-passage basis; if you use an <code>if</code> in one passage, you cannot place the matching <code>else</code> in a different passage. If you find yourself wanting to do something along these lines, instead repeat the same condition in the second passage and use an <code>unless</code> instead of an <code>if</code>.</p>
<h2 id="modifiers-including-conditional-ones-cannot-be-nested"><a class="header" href="#modifiers-including-conditional-ones-cannot-be-nested">Modifiers (Including Conditional Ones) Cannot Be Nested</a></h2>
<p>It is not possible to directly nest conditional modifiers in Chapbook. Meaning:</p>
<pre><code>[if hasKey]
You could [[open the door]]...

[if monsterDistance &lt; 2]
... and it might be your best chance for survival.
</code></pre>
<p>Would, if <code>hasKey</code> is false and <code>monsterDistance</code> is 1, only display:</p>
<pre><code>... and it might be your best chance for survival.
</code></pre>
<p>This is because modifiers only affect the text directly following them. They do not affect modifiers before or after them in the text, or any other text. You should instead write:</p>
<pre><code>[if hasKey]
You could [[open the door]]...

[if hasKey &amp;&amp; monsterDistance &lt; 2]
... and it might be your best chance for survival.
</code></pre>
<p>Let's take a more complicated example:</p>
<ul>
<li>The player must have first found a certain secret door by looking.</li>
<li>Once found, the door can only be unlocked with a key they previously found.</li>
<li>Once unlocked, the door remains open.</li>
</ul>
<p>This might be written in the popular SugarCube story format as:</p>
<pre><code>&lt;&lt;if $doorFound&gt;&gt;
&lt;&lt;if $doorUnlocked&gt;&gt;
The door stands open and unlocked, ready for you to [[enter it]].
&lt;&lt;else&gt;&gt;
You've found a door here, &lt;&lt;if $hasKey&gt;&gt;ready to be [[unlocked]]&lt;&lt;else&gt;&gt;but you haven't found a key yet that will open it.
&lt;&lt;/if&gt;&gt;
&lt;&lt;else&gt;&gt;
There seems to be nothing of note here, but perhaps [[a search would turn up something]].
&lt;&lt;/if&gt;&gt;
</code></pre>
<p>(This example omits, for brevity's sake, the other passages where <code>$doorFound</code> and <code>$hasKey</code> would be set.)</p>
<p>In Chapbook, you could instead use temporary variables to simplify some of the logic of the passage, and write:</p>
<pre><code>_doorOpen: doorFound &amp;&amp; doorUnlocked
_doorLocked: doorFound &amp;&amp; !doorUnlocked
--
[if _doorOpen]
The door stands open and unlocked, ready for you to [[enter it]].

[if _doorLocked]
You've found a door here,

[if _doorLocked &amp;&amp; hasKey; append]
ready to be [[unlocked]].

[if _doorLocked &amp;&amp; !hasKey; append]
but you haven't found a key yet that will open it.

[if !doorFound]
There seems to be nothing of note here, but perhaps [[a search would turn up something]].
</code></pre>
<p>Remember that <code>doorFound</code>, <code>doorUnlocked</code>, and <code>hasKey</code> are set in other passages. And beware--you cannot use an <code>[else]</code> in front of <code>but you haven't found a key yet that will open it.</code> The <code>else</code> will display in all cases that the <code>[if]</code> does not, even when <code>doorFound</code> is <code>false</code>.</p>
<p>An alternate method is to move parts of your logic to a separate passage and [embed it][embed-passage]:</p>
<pre><code>_doorOpen: doorFound &amp;&amp; doorUnlocked
_doorLocked: doorFound &amp;&amp; !doorUnlocked
--
[if doorFound &amp;&amp; doorUnlocked]
The door stands open and unlocked, ready for you to [[enter it]].

[if doorFound &amp;&amp; !doorUnlocked]
{embed passage: 'locked door logic'}

[if !doorFound]
There seems to be nothing of note here, but perhaps [[a search would turn up something]].
</code></pre>
<p>Which approach is best to take depends on the situation. It's not a good idea to embed passages more than one level deep.</p>
<h2 id="disabling-conditions-for-testing"><a class="header" href="#disabling-conditions-for-testing">Disabling Conditions For Testing</a></h2>
<p>It can be useful to override a conditional modifier so that it always or never displays, regardless of circumstances. To do this, change <code>[if]</code> to either <code>[ifalways]</code> or <code>[ifnever]</code>.</p>
<pre><code>[ifnever 1 + 1 === 2]
This would have been shown with a regular [if], but isn't.
</code></pre>
<p>This affects any <code>[else]</code> modifiers that follow it.</p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>Truthfully, it is also possible to write <code>[if stringVariable]</code> or <code>[if 2 + 2]</code>. In these cases, any non-empty string (e.g. not <code>''</code>) is treated as true, and any non-zero number is treated as true. It's best to be explicit, however, and write <code>[if stringVariable !== '']</code> and <code>[if 2 + 2 !== 0]</code>.
[embed-passage]: ../text-and-links/embedding-passages.html</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="conditions-and-variables"><a class="header" href="#conditions-and-variables">Conditions and Variables</a></h1>
<p>You cannot use inserts or modifiers in the vars section of a passage, so you cannot write something like:</p>
<pre><code>[if cousins &gt; 10]
largeFamily: true
--
You sit back in your chair and consider everyone you'll need to invite to the reunion.
</code></pre>
<p>Instead, there are two ways you can assign a variable a value based on a condition. First, you can assign a variable to the result of a comparison, either true or false:</p>
<pre><code>largeFamily: cousins &gt; 10
--
You sit back in your chair and consider everyone you'll need to invite to the reunion.
</code></pre>
<p>This passage sets the variable <code>largeFamily</code> to either <code>true</code> or <code>false</code>, depending on what value the variable <code>cousins</code> has. However, you may want to set variables to other types of values besides booleans. To do this, add a condition to the assignment:</p>
<pre><code>transportation: 'car'
transportation (kilometers &gt; 1000): 'plane' 
--
You'll need to take a {transportation} to get there.
</code></pre>
<p>This example demonstrates two new things about vars sections:</p>
<ul>
<li>You may change a variable more than once in a single vars section. Chapbook changes the variables in the order they are written, top to bottom.</li>
<li>If you write an expression inside parentheses before the colon (<code>:</code>) that tells Chapbook what value to set, that particular line will only take effect if the expression evaluates to <code>true</code>.</li>
</ul>
<p>So first <code>transportation</code> is set to <code>'car'</code>, and then, if <code>kilometers</code> is greater than <code>1000</code>, the value of <code>transportation</code> is immediately changed to <code>'plane'</code>. Chapbook runs through each variable assignment in sequence, doing nothing else in between, so the two assignments effectively work as one.</p>
<p>Here's a more complex example showing how multiple assignments and conditions go hand in hand.</p>
<pre><code>language: 'an unknown language'
language (country === 'Brazil'): 'Portuguese' 
language (country === 'China'): 'Mandarin' 
language (country === 'Ethiopia'): 'Amharic'
language (country === 'Russia'): 'Russian'
language (country === 'Australia' || country === 'United States'): 'English'
--
The official language of {country} is {language}.
</code></pre>
<p>Although Chapbook sets variables in the order you write them, often times it won't matter much, as you'll usually want to write conditions that are mutually exclusive of each other--that is, only one line ever takes effect.</p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>Truthfully, it is also possible to write <code>[if stringVariable]</code> or <code>[if 2 + 2]</code>. In these cases, any non-empty string (e.g. not <code>''</code>) is treated as true, and any non-zero number is treated as true. It's best to be explicit, however, and write <code>[if stringVariable !== '']</code> and <code>[if 2 + 2 !== 0]</code>.
[embed-passage]: ../text-and-links/embedding-passages.html</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="continuity-between-sessions"><a class="header" href="#continuity-between-sessions">Continuity Between Sessions</a></h1>
<p>Chapbook is designed so that players don't need to manually save their progress, as is often typical in digital games. Instead, it silently saves the state of play every time the player navigates to a new passage.</p>
<p>This is partly by necessity and partly by design. It's necessary to continually save progress because browsers, especially those on mobile devices, are extremely stingy with resources. If a player begins your story but decides to check social media in another browser tab and then gets lost in a series of adorable cat pictures, the browser may decide to put your story's tab into the equivalent of hibernation. When the player returns to your story, the browser essentially reloads the story<sup class="footnote-reference"><a href="#1">1</a></sup>, which causes any unsaved progress to be lost. Thus, progress needs to be continually saved.</p>
<p>It also discourages a habit in players that is nicknamed <em>[save scumming]</em>, where players constantly save and reload their progress in an effort to find what they believe is the most optimal outcome. </p>
<p>Chapbook saves state by using a feature of web browsers called <em>local storage</em>. If you are familiar with browser cookies, local storage works similarly to them, though local storage allows for storing much more data than a cookie. You don't need to know what either technology is to use Chapbook successfully, but it is important to understand two things:</p>
<ol>
<li>
<p>A player's state is saved only to their device, and to the browser they are using. If a player starts out using Microsoft Edge but changes halfway to Mozilla Firefox, they'll start from the very beginning of your story in Firefox. Their progress in Edge isn't lost, of course. Likewise if they begin on their phone and switch to a laptop halfway through, they will start from the beginning.</p>
</li>
<li>
<p>If a player clears their browsing history, they'll lose their progress in your story.</p>
</li>
</ol>
<p>Because state is retained across sessions, you <em>must</em> use the [<code>{restart link}</code> insert][restart-insert] in order to start the story fresh once you begin using state in your stories. If you only link back to the first passage, variables will remain in the state they were at the end of play--which is likely to produce weird results.</p>
<p>{% hint style='working' %}
Additional functionality related to saving progress, such as being able to share saved states between browsers or devices, or allowing players on a device the ability to have more than one save, may come in a future version of Chapbook.
{% endhint %}</p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>In fact, you'll often see a loading indicator briefly when this occurs, instead of the page reappearing instantly.
[save scumming]: http://tvtropes.org/pmwiki/pmwiki.php/Main/SaveScumming
[restart-insert]: ../text-and-links/link-inserts.html#restarting-the-story</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="state-backstage"><a class="header" href="#state-backstage">State Backstage</a></h1>
<p>State can be very slippery to work with, as it's not normally directly visible in your story--you can only infer from its side effects. Chapbook provides tools to track and even change state as you test your story.</p>
<h2 id="the-state-tab"><a class="header" href="#the-state-tab">The State Tab</a></h2>
<p>Under the State tab, you'll find a Variables heading. This shows the current state of your story as you play. You can also select a value on the right side of the variables table and enter a new one--press the Return or Enter key when you're done to set the variable. You may only enter values in the variables table, not expressions.</p>
<p>If the Show Defaults checkbox is ticked, Chapbook will show various built-in variables--mainly related to Chapbook's configuration. See <a href="state/../customization/index.html">Customization</a> for more details.</p>
<h2 id="state-snaphots"><a class="header" href="#state-snaphots">State Snaphots</a></h2>
<p>Beneath the variables table is the Snapshots heading. Snapshots allow you to quickly save and restore the state of your story at any point. For example, if you'd like to skip the prologue or test a specific scene, play through your story as usual. When you've reached the point you'd like to skip to, use the Add Snapshot button. After giving your snapshot a name, it will appear under the Snapshots heading as a button. Using this button will immediately set the state of your story, including the passage you were viewing, to what it was.</p>
<p>Use the × button at the end of a snapshot button to remove it. Snapshots are saved to your web browser only.</p>
<p>{% hint style='working' %}
Exporting snapshots for use by other people working on your story may come in a future version of Chapbook.
{% endhint %}</p>
<h2 id="state-in-history"><a class="header" href="#state-in-history">State in History</a></h2>
<p>The History tab also shows changes to state as you navigate through a story. If a passage changes a variable, you'll see a separate row in the history table showing that change. This is informational only--you cannot change variables from the History tab.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="objects-and-lookup-variables"><a class="header" href="#objects-and-lookup-variables">Objects and Lookup Variables</a></h1>
<p>In addition to variables you create, Chapbook also maintains a number of built-in variables called <em>lookups</em>. Unlike regular variables, lookups cannot be changed by you. Instead, they correspond to properties in the environment--the current date and time when the player is interacting with your story, for example, or even the story itself.</p>
<h2 id="introducing-objects"><a class="header" href="#introducing-objects">Introducing Objects</a></h2>
<p>In order to leave as many variable names available to you as possible, Chapbook groups its built-in lookup variables together using <em>objects</em>. An objects are another type of variable--like a string, boolean, or number--that acts as a container for other variables. Unlike simple variable types like strings or numbers, objects don't have values unto themselves. They only contain other variables.</p>
<p>To access a variable inside an object container, enter the object's name, then a period (<code>.</code>), then the variable. For instance, <code>story.name</code> accesses the variable named <code>name</code> inside of <code>story</code>.</p>
<p>You can nest objects as much as you'd like, and you can also write something like this in the vars section of a passage:</p>
<pre><code>my.favorite.variable: 'red'
</code></pre>
<p>Chapbook will create each object variable (e.g. <code>my</code> and <code>favorite</code>) for you if it doesn't already exist.</p>
<h2 id="built-in-lookup-variables"><a class="header" href="#built-in-lookup-variables">Built-In Lookup Variables</a></h2>
<p>Below is a list of lookups that Chapbook maintains for you:</p>
<div class="table-wrapper"><table><thead><tr><th>Variable Name</th><th>Description</th><th>Example</th></tr></thead><tbody>
<tr><td><code>browser.height</code></td><td>The height of the browser window in pixels.</td><td><code>768</code></td></tr>
<tr><td><code>browser.online</code></td><td>Whether the browser currently has a network connection.</td><td><code>true</code></td></tr>
<tr><td><code>browser.width</code></td><td>The width of the browser window in pixels.</td><td><code>1024</code></td></tr>
<tr><td><code>engine.version</code></td><td>The version of Chapbook currently running, as a string.</td><td><code>'1.0.0'</code></td></tr>
<tr><td><code>now.datestamp</code></td><td>A short human-readable description of the date right now.</td><td><code>'2/15/2011'</code></td></tr>
<tr><td><code>now.day</code></td><td>The current day of the month, 1-31.</td><td><code>15</code></td></tr>
<tr><td><code>now.hour</code></td><td>The hour of the time right now, where midnight is 0 and 11:00 PM is 23.</td><td><code>18</code></td></tr>
<tr><td><code>now.minute</code></td><td>The minute of the time right now, 0-59.</td><td><code>15</code></td></tr>
<tr><td><code>now.month</code></td><td>The current month, 1-12.</td><td><code>2</code></td></tr>
<tr><td><code>now.monthName</code></td><td>The name of the current month.</td><td><code>'February'</code></td></tr>
<tr><td><code>now.second</code></td><td>The second of the time right now, 0-59.</td><td><code>45</code></td></tr>
<tr><td><code>now.timestamp</code></td><td>A short human-readable description of the time right now.</td><td><code>'6:18:15 PM'</code></td></tr>
<tr><td><code>now.weekday</code></td><td>The current day of the week, where Sunday is 1, Wednesday is 4, and Saturday is 7.</td><td><code>3</code></td></tr>
<tr><td><code>now.weekdayName</code></td><td>The name of the current day of the week.</td><td><code>'Tuesday'</code></td></tr>
<tr><td><code>now.year</code></td><td>The current four-digit year.</td><td><code>2011</code></td></tr>
<tr><td><code>passage.name</code></td><td>The name of the current passage as set in the Twine editor.</td><td><code>'Untitled Passage'</code></td></tr>
<tr><td><code>passage.visits</code></td><td>The number of times the player has seen the current passage, including the current time. That is, the first time the player sees a passage, this lookup's value is 1.</td><td>1</td></tr>
<tr><td><code>story.name</code></td><td>The name of the story as set in the Twine editor.</td><td><code>'Untitled Story'</code></td></tr>
</tbody></table>
</div>
<p>Note that <code>now</code> lookup values reflect when they were last accessed, which is usually when a passage is navigated to. String values like <code>now.monthName</code> will vary by the language the player has set as default in their browser-- a French person will see <code>Août</code> where an American sees <code>August</code>, for example, and similarly the French will see <code>now.datestamp</code> as <code>'15/2/2011'</code> where Americans see it as <code>'2/15/2011'</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="randomness"><a class="header" href="#randomness">Randomness</a></h1>
<p>Randomness is a powerful tool for creating interactive experiences. It can assist with simulation--to decide whether actions of a character succeed, as in tabletop role-playing games--but it can also be used for aesthetic purposes, from altering phrasings in text to creating an entirely randomized narrative.</p>
<p>The main way to make use of randomness with Chapbook is through <a href="state/objects-and-lookups.html">lookup variables</a> in the <code>random</code> object. For instance:</p>
<pre><code>[if random.coinFlip]
Heads!

[else]
Tails!
</code></pre>
<p>... will display &quot;Heads!&quot; half of the time the story is played and &quot;Tails!&quot; the other half. The value of <code>random.coinFlip</code> potentially changes every time its value is used.<sup class="footnote-reference"><a href="#1">1</a></sup></p>
<p>For more fine-grained randomness, you can use lookup variables such as <code>random.d100</code>, which is a random whole number between 1 to 100. The full list is:</p>
<div class="table-wrapper"><table><thead><tr><th>Lookup</th><th>Range</th></tr></thead><tbody>
<tr><td><code>random.fraction</code></td><td>0-1</td></tr>
<tr><td><code>random.d4</code></td><td>1-4</td></tr>
<tr><td><code>random.d5</code></td><td>1-5</td></tr>
<tr><td><code>random.d6</code></td><td>1-6</td></tr>
<tr><td><code>random.d8</code></td><td>1-8</td></tr>
<tr><td><code>random.d10</code></td><td>1-10</td></tr>
<tr><td><code>random.d12</code></td><td>1-12</td></tr>
<tr><td><code>random.d20</code></td><td>1-20</td></tr>
<tr><td><code>random.d25</code></td><td>1-25</td></tr>
<tr><td><code>random.d50</code></td><td>1-50</td></tr>
<tr><td><code>random.d100</code></td><td>1-100</td></tr>
</tbody></table>
</div>
<p>All of the lookups listed above are always whole numbers, except <code>random.fraction</code>, which is a decimal between 0 and 1.</p>
<p>One easy mistake that can be made with these lookup variables is to forget that their values change every time they are used. For instance:</p>
<pre><code>[if random.d4 === 1]
One.

[if random.d4 === 2]
Two.

[if random.d4 === 3]
Three.

[if random.d4 === 4]
Four.
</code></pre>
<p>The passage above may show just one paragraph, but it's also possible for it to show more than one, or even none at all. Because <code>random.d4</code> changes value, the end result could look like this:</p>
<pre><code>[if 4 === 1]
One.

[if 2 === 2]
Two.

[if 1 === 3]
Three.

[if 4 === 4]
Four.
</code></pre>
<p>... which would display:</p>
<pre><code>Two.

Four.
</code></pre>
<p>If you'd like to re-use a specific random value, the easiest thing to do is to assign it to a variable like so:<sup class="footnote-reference"><a href="#2">2</a></sup></p>
<pre><code>_chosen: random.d4
--
[if _chosen === 1]
One.

[if _chosen === 2]
Two.

[if _chosen === 3]
Three.

[if _chosen === 4]
Four.

</code></pre>
<h2 id="chapbook-is-pseudorandom"><a class="header" href="#chapbook-is-pseudorandom">Chapbook Is Pseudorandom</a></h2>
<p>Chapbook's randomness is not truly random: in fact, the process by which it generates random numbers is entirely predictable. This may sound ludicrous, but this is how almost all computer-generated random numbers work. Chapbook uses what is called a pseudorandom number generator, which generates a stream of apparently random numbers based on a seed value.</p>
<p>The pseudorandom number generator will always generate the same values when using a particular seed value. Unless otherwise specified, Chapbook will use a seed value based on the date and time that a playthrough first begins, so each session will see different pseudorandom values. Chapbook stores this seed value in <code>config.random.seed</code>. This variable can be both read and written to.</p>
<p>Why would you want to change the pseudorandom seed, though? It can help with testing--for example, if someone reports a problem with your story, you can set your seed value to theirs and be able to replay things exactly as they experienced them. You can also set a seed value manually in a version of your story you give to others to test, so that you can ensure everyone has a consistent experience.</p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>Which is to say it is possible, as demonstrated in <em><a href="https://en.wikipedia.org/wiki/Rosencrantz_and_Guildenstern_Are_Dead#Act_One">Rosencrantz and Guildenstern Are Dead</a></em>, that <code>random.coinFlip</code> holds the same value after it is read. 
<sup class="footnote-reference"><a href="#2">2</a></sup>: This example uses an underscore in its variable name to signal a temporary variable, but remember that this is merely a convention.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><div class="intro multimedia">
    <h1 id="multimedia"><a class="header" href="#multimedia">Multimedia</a></h1>
</div>
<p>This section covers adding images, audio, and video to your stories.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="publishing-models"><a class="header" href="#publishing-models">Publishing Models</a></h1>
<p>Twine 2 does not currently permit embedding images, audio, or video--assets, for short--in your story files. This is so that your story loads quickly and efficiently. Twine 1 permitted this by encoding them using a technique called Base64, which converts binary data into text that can be safely embedded into HTML. This has two disadvantages:</p>
<ul>
<li>Base64 adds a 33% overhead to file sizes, causing stories to load
significantly slower than they could otherwise.</li>
<li>A story couldn't begin to be played until all its assets had completely
downloaded. This can be troublesome if a story uses many images, but this
would be disastrous for audio and video, where files are ten times as large.</li>
</ul>
<p>In Twine 2, any multimedia assets must exist separately from the published story file itself. There are two approaches you can take. Either one is equally viable--it depends on your situation.</p>
<h2 id="self-contained-publishing"><a class="header" href="#self-contained-publishing">Self-Contained Publishing</a></h2>
<p>In this approach, you publish assets used by your story in the same place as the published story file itself. A typical arrangement is shown below:</p>
<ul class="directory-listing">
	<li class="file">Story.html</li>
	<li class="directory">Assets
	    <ul>
	        <li class="directory">Images
	            <ul>
	                <li class="file">Photo 1.jpeg</li>
	                <li class="file">Photo 2.jpeg</li>
	            </ul>
	        </li>
	        <li class="directory">Audio
	            <ul>
	                <li class="file">Intro Song.mp3</li>
	            </ul>
	        </li>
	    </ul>
	</li>
</ul>
<p>One advantage of the self-contained approach is that your work can be easily packaged into an archive file, usually in ZIP format, and made available on digital marketplaces. In this scenario, a player can download your story once, unpack it, and begin playing without having to have an active Internet connection.</p>
<p>A self-contained story can be published to a web site, so that players don't have to go to the extra step of downloading the archive file and expanding it, but you should be aware of the bandwidth the site will use. Bandwidth is a measurement of how much data is transferred to and from a web site. If you publish a story with an audio file that is 1 MB in size (about a minute long) that 1,000 people play, the site will consume 1 GB of bandwidth.</p>
<p>Some web site hosting providers promise unlimited bandwidth at a flat fee, but throttle connections if a site uses too much bandwidth; others will temporarily shut a site down that uses too much bandwidth. Others will keep your site available at full speed no matter how much bandwidth you consume, but charge you a variable--sometimes steep--amount of money depending on how much bandwidth it consumes.</p>
<p>All of which is to say: if you plan to post a self-contained story to a web site, you should understand the constraints of the hosting provider you use.</p>
<p>Another disadvantage to self-contained publishing is that Twine 2 doesn't currently have many tools to help you while you are creating your story. In order for assets to display correctly, you'll have to publish your story to the same folder as your assets. Testing your story inside Twine 2 will not display the assets correctly.</p>
<p>When you add assets to a self-contained story, you'll use a <em>relative URL</em>. You've encountered URLs before; they appear at the top of a web browser window, and indicate the location at which a resource is stored. They typically begin with <code>http://</code> or <code>https://</code>. Relative URLs, however, locate a resource in relation to your published story file. In the diagram above, the relative URL for the intro song is <code>Assets/Audio/Intro Song.mp3</code>. A relative URL does not start with any preamble; instead, each directory beneath the story file's directory is separated by a forward slash (<code>/</code>), with the file name of the asset given last. If you link to an asset in the same directory as the published story file, the filename of the asset works as a relative URL.</p>
<h2 id="cloud-publishing"><a class="header" href="#cloud-publishing">Cloud Publishing</a></h2>
<p>In this approach, you publish your assets to an existing service like Flickr or YouTube. Your story file can be downloaded or posted to a web site, but your assets will load from these external sites. As such, players will need to have an active Internet connection as they play.</p>
<p>Cloud publishing means you won't have to worry about bandwidth, but in exchange most services place some kind of watermark or other identifying information on your asset so that it's clear that you're using their service. Hosting services also have terms of service that may place restrictions on what kind of content you post.</p>
<p>Cloud publishing also allows you to test stories inside Twine 2 without having to publish your story to a file. To do this, you'll sometimes use an <em>embed code</em> to incorporate your assets into your story, which is a fragment of HTML source code provided by the service you use.</p>
<p>If you choose to use assets in the cloud, it's important that you ensure that you are legally able to do so. It is tempting to <em>hotlink</em> resources--that is, embed assets from another server without permission. This is bad form at minimum, as you are potentially incurring bandwidth costs for the site owner (as noted in <em>Self-Contained Publishing Above</em> above), but if a site owner finds out you've done this, they can remove the assets you've linked to or replace them with something obnoxious or embarrassing.</p>
<style>

ul.directory-listing {
	margin-left: 0;
	padding-left: 0;
}

ul.directory-listing, ul.directory-listing ul {
	list-style-type: none;
}

ul.directory-listing ul {
	margin-left: 0;
	padding-left: 0;
}

ul.directory-listing li.file, ul.directory-listing li.directory {
	padding-left: 24px;
	background-repeat: no-repeat;
	background-size: 16px;
	background-position: 4px 3px;
	min-height: 24px;
}

ul.directory-listing li.file {
	background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJmZWF0aGVyIGZlYXRoZXItZmlsZSI+PHBhdGggZD0iTTEzIDJINmEyIDIgMCAwIDAtMiAydjE2YTIgMiAwIDAgMCAyIDJoMTJhMiAyIDAgMCAwIDItMlY5eiI+PC9wYXRoPjxwb2x5bGluZSBwb2ludHM9IjEzIDIgMTMgOSAyMCA5Ij48L3BvbHlsaW5lPjwvc3ZnPg==);
}

ul.directory-listing li.directory {
	background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJmZWF0aGVyIGZlYXRoZXItZm9sZGVyIj48cGF0aCBkPSJNMjIgMTlhMiAyIDAgMCAxLTIgMkg0YTIgMiAwIDAgMS0yLTJWNWEyIDIgMCAwIDEgMi0yaDVsMiAzaDlhMiAyIDAgMCAxIDIgMnoiPjwvcGF0aD48L3N2Zz4=);
}

</style><div style="break-before: page; page-break-before: always;"></div><h1 id="images"><a class="header" href="#images">Images</a></h1>
<h2 id="embedding-your-own-images"><a class="header" href="#embedding-your-own-images">Embedding Your Own Images</a></h2>
<p>To display an image in a passage, use the <code>{embed image}</code> insert:</p>
<pre><code>For all you know, not a single person has entered this cave in a thousand years. The cave entrance is covered in moss and leaves.

{embed image: 'cave.jpeg', alt: 'Cave entrance'}
</code></pre>
<p>The <code>alt</code> property is explained below under &quot;Alternate Text.&quot;</p>
<h2 id="embedding-images-from-flickr"><a class="header" href="#embedding-images-from-flickr">Embedding Images from Flickr</a></h2>
<p><a href="https://flickr.com">Flickr</a> is a venerable photography service that allows people to mark their uploaded photos as embeddable. If a photo can be embedded, you will see an icon that looks a bit like an arrow in the lower right of the photo. Selecting that option will display the embed code to use, which is rather lengthy. Make sure to use the code found in the Embed tab, not the Share or BBCode ones. Once you have the code, use the <code>{embed Flickr image}</code> insert as below.</p>
<pre><code>The night sky is alive:

{embed Flickr image: '&lt;a data-flickr-embed=&quot;true&quot;  href=&quot;https://www.flickr.com/photos/kees-scherer/43929816675/in/photolist-29VVN1k-MxBBfR-Mxmaoa-2abPdAf-28uxzXE-MsR1ev-MqbA18-P2bWEY-29LvwHZ-P1DPQ7-2b3znq5-28jiA4E-2b4qGd6-29QQrVa-2a4C5X3-MhDEFV-2b3tVwa-MfPdhz-2aZTken-2aTGEx1-2aVbrLg-NLVUU7-289o89h-288U1wq-2aN6BuN-NH87Jm-2aQH3Ta-NDwgPd-NB3Mym-2aHjvXP-29jgSN2-29zFLg5-27TFbQw-Nw3iLs-2aD2Dfn-27SXWGo-29f84mZ-LRdL8r-2aVtHgk-2awe7hj-29ux7nq-LPVrYk-2avhxQJ-2azf7ct-2ayX3mM-2aygKz8-27Nwi91-27NmmvS-NqvSME-2axAzDV&quot; title=&quot;The Andromeda Galaxy, Messier 31&quot;&gt;&lt;img src=&quot;https://farm2.staticflickr.com/1857/43929816675_07357e53b0_m.jpg&quot; width=&quot;240&quot; height=&quot;185&quot; alt=&quot;The Andromeda Galaxy, Messier 31&quot;&gt;&lt;/a&gt;&lt;script async src=&quot;//embedr.flickr.com/assets/client-code.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;', alt: 'the Andromeda galaxy'}
</code></pre>
<p>{% hint style='danger' %}
Just because Flickr allows you to embed an image does not mean you have the <em>right</em> to use it in your story freely. Check the image's page for the license the photo's uploader is using. Some may not be allowed to be used in commercial projects, while others may not allow usage at all.
{% endhint %}</p>
<h2 id="embedding-images-from-unsplash"><a class="header" href="#embedding-images-from-unsplash">Embedding Images from Unsplash</a></h2>
<p><a href="https://unsplash.com">Unsplash</a> is a stock photography service that hosts photos that can embedded into a story royalty-free. To use an image from Unsplash, combine the <code>{embed Unsplash image}</code> insert with the image's URL on unsplash.com. No embed code is required.</p>
<pre><code>{embed Unsplash image: 'https://unsplash.com/photos/Na0BbqKbfAo', alt: 'the moon'}

What a horrible night to have to study for exams.
</code></pre>
<p>{% hint style='working' %}
Other types of image embeds may come in a future version of Chapbook, as well as more flexibility in layout--e.g. having an image appear to the left or right of the text.
{% endhint %}</p>
<h2 id="alternate-text"><a class="header" href="#alternate-text">Alternate Text</a></h2>
<p>Regardless of where your image comes from, you must give it <em>alternate text</em>. This is so that players who have a visual disability are able to have an equivalent experience to those who don't. <a href="https://webaim.org/techniques/alttext/">WebAIM</a> has an excellent in-depth treatment of alternative text, but the gist is that it should contain a brief description of what the image depicts, that would work well for someone reading your story out loud. Because, for players with a visual disability, they often in fact will have your story read out loud by screen reader software.</p>
<p>When writing alternate text, avoid phrases like &quot;image of Abraham Lincoln&quot; or &quot;Boston Harbor photo&quot;-- just write &quot;Abraham Lincoln&quot; or &quot;Boston Harbor.&quot;</p>
<p>If your image is purely decorative--say, a fancy border--then it should have empty alternative text, so that screen readers will skip over it: This doesn't mean omitting <code>alt</code> entirely, but setting it to an empty string, as below.</p>
<pre><code>{embed image: 'asterisk.jpeg', alt:''}
</code></pre>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>Although several browsers, Safari most prominent among them, hide the full URL from you unless uo specifically ask for it.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="audio"><a class="header" href="#audio">Audio</a></h1>
<p>Chapbook supports two types of audio: <em>ambient sound</em> and <em>sound effects</em>. Ambient sounds are long-running audio, such as music or background noise, that automatically loop when playback completes. Sound effects are one-off sounds, like the sound of a door opening or an explosion.</p>
<p>There are two other differences between sound effects and ambient audio:</p>
<ul>
<li>There can only be one ambient sound playing at a time under normal circumstances.</li>
<li>Sound effects are preloaded when your story begins. This is so that when you ask for an effect to be played in your story, there will be as little delay as possible before it begins playback. However, this means that you should be careful about the file size of the sound effects you use. The preloading process takes place in the background as players interact with your story, so large sound effects will not delay the start of your story. But it's still wasteful to load large files.</li>
</ul>
<p>You should also make sure that all your sounds are in MP3 format. There are other types of audio formats, such as Ogg Theora or WAV, but browser support varies for each of these. MP3 is as universal a format as possible. There are many applications, including the open-source <a href="https://www.audacityteam.org/">Audacity</a>, that can convert audio files into MP3 format for you.</p>
<h2 id="sound-effects"><a class="header" href="#sound-effects">Sound Effects</a></h2>
<p>Before playing a sound effect, you must first define it in your story state. Below is an example of how you would define a sound effect:</p>
<pre><code>sound.effect.explosion.url: 'boom.mp3'
sound.effect.explosion.description: 'a large explosion'
--
The timer reads 0:00...
</code></pre>
<p>The <code>explosion</code> keyword defines the name of the ambient sound, which you'll use later. The <code>url</code> property defines the address to load the sound from, and the <code>description</code> provides a textual description of the contents of the sound. This is so that players who have difficulty hearing, or who have muted your story, can receive an alternate version of the sound.</p>
<p>Once you've defined your sound effect, you can play it in a passage using the <code>{sound effect}</code> insert.</p>
<pre><code>sound.effect.explosion.url: 'boom.mp3'
sound.effect.explosion.description: 'a large explosion'
--
The timer reads 0:00...

{sound effect: 'explosion'}
</code></pre>
<p>The exact place you put the insert matters. If a player has disabled sound, or is unable to hear your sound, they will see the text of the <code>description</code> property instead where you enter the insert.</p>
<p>If you insert multiple different sound effects in a single passage, they will play simultaneously. If you insert a sound effect in another passage the player reaches while the effect is stil playing, the second insert will have no effect.</p>
<p>If you need to play a sound effect repeatedly, define it multiple times. You can assign the entire object to save time. For example:</p>
<pre><code>sound.effect.explosion.url: 'boom.mp3'
sound.effect.explosion.description: 'a large explosion'
sound.effect.explosion2: sound.effect.explosion
--
The timer reads 0:00...

{sound effect: 'explosion'}

[[Oof.]]
</code></pre>
<p>(Note the lack of quotation marks around <code>sound.effect.explosion</code> in the line that sets <code>sound.effect.explosion2</code>.)</p>
<p>Assigning the <code>sound.effect.explosion2</code> <a href="multimedia/../state/objects-and-lookups.html">object</a> wholesale, instead of setting it property-by-property, causes it to be a copy of <code>sound.effect.explosion</code>. If you ever change a property of <code>sound.effect.explosion</code>, <code>sound.effect.explosion2</code> will change too.</p>
<p>And then, in the passage named <code>Oof.</code>, you'd write:</p>
<pre><code>That wasn't so bad. Wait...

{sound effect: 'explosion2'}
</code></pre>
<h2 id="ambient-sound"><a class="header" href="#ambient-sound">Ambient Sound</a></h2>
<p>The process of defining an ambient sound is very similar to defining a sound effect.</p>
<pre><code>sound.ambient.forest.url: 'forest.mp3'
sound.ambient.forest.description: 'midday forest sounds'
--
It's a beautiful day.
</code></pre>
<p>Similarly, you begin playing an ambient sound with an insert:</p>
<pre><code>sound.ambient.forest.url: 'forest.mp3'
sound.ambient.forest.description: 'midday forest sounds'
--
{ambient sound: 'forest'}

It's a beautiful day.

</code></pre>
<p>The only difference here is that the sound will fade in, and if there was already an ambient sound playing, the two will crossfade. The exact length of the fade is determined by the state variable <code>sound.transitionDuration</code>. It is a string in the same format that the <a href="multimedia/../modifiers-and-inserts/delayed-text.html">after modifier</a> accepts.</p>
<p>To stop playing all ambient sound, write <code>{no ambient sound}</code>.</p>
<h2 id="controlling-sound-volume"><a class="header" href="#controlling-sound-volume">Controlling Sound Volume</a></h2>
<p>To set the master sound volume for your story, change the state variable <code>sound.volume</code> to a decimal between 0 and 1. 0 is muted, and 1 is full volume. You can also temporarily mute all sound by setting <code>sound.mute</code> (note the lack of a D at the end) to <code>true</code>. The advantage of using <code>sound.mute</code> is that it allows you to toggle between no sound and a previously-set volume.</p>
<p>You can also set a sound's volume when playing it using an insert. Both of the inserts below begin playing a sound at half normal volume.</p>
<pre><code>{sound effect: 'explosion', volume: 0.5}
{ambient sound: 'forest', volume: 0.5}
</code></pre>
<h2 id="browser-autoplay-problems"><a class="header" href="#browser-autoplay-problems">Browser Autoplay Problems</a></h2>
<p>Chapbook makes every effort to resume sound playback between play sessions, so that if you begin playing an ambient sound, it resumes whenever the player comes back to your story. However, this runs afoul of strict restrictions most browsers have regarding sound that immediately plays when a web page is loaded. Some browsers have a blanket ban on this, while others take into account a player's behavior on the web site hosting your story--if a player has previously interacted a lot with the site, it may allow it, but the exact criteria for allowing it is often unclear.</p>
<p>Playing sound after a player has followed a link or otherwise clicked or tapped a link in your story should always work, whatever a browser's autoplay policy is.</p>
<h2 id="manually-controlling-sound"><a class="header" href="#manually-controlling-sound">Manually Controlling Sound</a></h2>
<p>You may also manually play sounds, either sound effects or ambient sound, by setting their <code>playing</code> property to <code>true</code>. This property automatically becomes <code>false</code> once an effect finishes playing, but will never change for ambient sound unless you use an <code>{ambient sound}</code> insert or set its <code>playing</code> property to <code>false</code> again.</p>
<p>You can use this for more complex effects, such as layering ambient sounds; however, you <em>must</em> make sure to include appropriate descriptions for people who are unable to hear your audio. To do this, enclose the description inside <code>&lt;audio&gt;</code> and <code>&lt;/audio&gt;</code> like so:</p>
<pre><code>sound.ambient.forest.playing: true
sound.ambient.rain.playing: true
--
You walk outside.

&lt;audio&gt;Rainy forest background sound&lt;/audio&gt;
</code></pre>
<p>The text inside the will not be displayed ordinarily.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="video"><a class="header" href="#video">Video</a></h1>
<h2 id="embedding-your-own-video"><a class="header" href="#embedding-your-own-video">Embedding Your Own Video</a></h2>
<p>{% hint style='working' %}
Chapbook doesn't yet support embedding your own video, but it will.
{% endhint %}</p>
<h2 id="embedding-a-youtube-video"><a class="header" href="#embedding-a-youtube-video">Embedding a YouTube Video</a></h2>
<p>You've heard of <a href="https://youtube.com">YouTube</a>, right? To embed a YouTube video, use its URL with the <code>{embed YouTube video}</code> insert:</p>
<pre><code>Tell me if you've seen this one before.

{embed YouTube video: 'https://www.youtube.com/watch?v=9bZkp7q19f0'}
</code></pre>
<p>{% hint style='working' %}
For now, it's not possible to have a YouTube video start when a passage displays. The player will need to begin playback.
{% endhint %}</p>
<p>{% hint style='working' %}
Accessibility features for video will be added to a future release of Chapbook.
{% endhint %}</p>
<div style="break-before: page; page-break-before: always;"></div><div class="intro customization">
    <h1 id="customization"><a class="header" href="#customization">Customization</a></h1>
</div>
<p>This section describes how to customize the appearance and behavior of your story in a web browser, including colors and font faces.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-header-and-footer"><a class="header" href="#the-header-and-footer">The Header and Footer</a></h1>
<p>Normally, Chapbook displays your story's title and a link to restart it at the bottom of the page. This area, called the <em>footer</em>, can be changed to include additional information and links. You can also add information at the top of the page, in its <em>header</em>, in a similar manner. The <em><a href="https://klembot.github.io/chapbook/examples/cloak-of-darkness.html">Cloak of Darkness</a></em> example, for instance, displays the current location in the header.</p>
<p>The header and footer are further divided into three areas: <em>left</em>, <em>center</em>, and <em>right</em>. You do not need to place content into each area--Chapbook does its best to evenly space your content regardless of which areas you use.</p>
<p>To change a header or footer area, set the corresponding variable in the <code>config</code> object.</p>
<table style="border: 1px solid #ddd; text-align: center">
	<tbody>
		<tr>
			<td><code>config.header.left</code></td>
			<td><code>config.header.center</code></td>
			<td><code>config.header.right</code></td>
		</tr>
		<tr>
			<td colspan="3"><i>main passage text</i></td>
		</tr>
		<tr>
			<td><code>config.footer.left</code></td>
			<td><code>config.footer.center</code></td>
			<td><code>config.footer.right</code></td>
		</tr>
	</tbody>
</table>
<p>Remember that you must set the object property to a string for it to function correctly--meaning, you must put single or double quotes around the value. For example:</p>
<pre><code>config.header.center: &quot;Midday&quot;
</code></pre>
<p>The contents of the variable are interpreted the same way that passage text is, so you can use links, <a href="customization/../modifiers-and-inserts/link-inserts.html">inserts</a>, and, technically, <a href="customization/../modifiers-and-inserts/modifiers-and-text-alignment.html">modifiers</a> in the variables:</p>
<pre><code>config.header.right: &quot;Money left: {money}&quot;
config.footer.center: &quot;[[Other stories in this anthology]]&quot;
</code></pre>
<p>The header and footer are designed to display a single line of text, though, so modifiers are probably of limited use. The header and footer are updated every time a new passage is shown in the body of the page, so variable inserts like the one shown above will automatically update during play.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fonts-and-colors"><a class="header" href="#fonts-and-colors">Fonts and Colors</a></h1>
<p>The easiest way to customize your story's fonts and colors is with the <strong>Style</strong> backstage tab<sup class="footnote-reference"><a href="#1">1</a></sup>, which sets values in the <code>config.style</code> object for you. As you make changes in that tab, your story's appearance will automatically update, so you can easily experiment to find a look that fits your story. However, changes you make will not be permanently saved-- the next time you test or play your story, it will revert back to its previous appearance.</p>
<p>In order to make changes in the <strong>Style</strong> tab permanent, you must copy the code in the <strong>Config</strong> panel at the top of the tab into your starting passage's vars section. (This passage is shown with a rocket-ship icon in Twine's story map.) Clicking anywhere in the box the code sits in will automatically select all of it to make copying and pasting easy.</p>
<p>Doing so will cause the appropriate variables to be set when your story first begins-- which doesn't mean that it has to be the only appearance your story takes on. You can change variables in the <code>config.style</code> object in a later passage's vars section and your story's appearance will change when the passage is visited. You could use this, for example, to denote a dream sequence or flashback.</p>
<p>The other panels in the <strong>Style</strong> tab, <strong>Page</strong>, <strong>Header</strong>, and <strong>Footer</strong>, all have the same fields. As you might guess, <strong>Page</strong> sets the base style of your story and <strong>Header</strong> and <strong>Footer</strong> govern the areas above and below the main text. By default, Chapbook stories don't have a header.</p>
<div class="page-diagram">
	<div class="header">header</div>
	<div class="content">main content</div>
	<div class="footer">footer</div>
</div>
<p>The values you set for page, header, and footer styles inherit from each other. That means that if a header or footer style value isn't set, it will use the corresponding page value instead. If a page value isn't set either, Chapbook's default style will be used instead.</p>
<h2 id="setting-text-style"><a class="header" href="#setting-text-style">Setting Text Style</a></h2>
<p>{% hint style=&quot;info&quot; %}
Applies to:</p>
<ul>
<li><code>config.style.page.font</code></li>
<li><code>config.style.page.link.font</code></li>
<li><code>config.style.page.link.active.font</code></li>
<li><code>config.style.page.header.font</code></li>
<li><code>config.style.page.header.link.font</code></li>
<li><code>config.style.page.header.link.active.font</code>
{% endhint %}</li>
</ul>
<p>Chapbook uses a concise notation for specifying text style. Below is a simple example:</p>
<pre><code>Palatino 18
</code></pre>
<p>This sets a Palatino typeface at 18 pixels tall.<sup class="footnote-reference"><a href="#2">2</a></sup> But in actual use, you ought to use something like this instead:</p>
<pre><code>Palatino/serif 18
</code></pre>
<p>Slashes separate alternate typefaces in what is called a <em>font stack</em>. Before the advent of web fonts, font stacks were a crucial part of web design. At that time, web browsers were only capable of displaying fonts installed in the operating system, so designers had to specify alternate typefaces in order to create a consistent appearance across different operating systems.</p>
<p>In our current times, font stacks affect more what a page looks like at first glance--typically, text appears immediately in a system font, then in a web font after it finishes loading. (See [External Web Fonts][external-web-fonts.md] for details on how to use a web font with Chapbook.) But there are players who will have disabled web fonts, either out of personal preference or a need to save network bandwidth, and it's good practice to design your story to accommodate that.</p>
<p>The example above indicates that if a typeface named Palatino isn't available to the player's web browser, <code>serif</code> signals it should fall back to a generic serif font.<sup class="footnote-reference"><a href="#3">3</a></sup> If you'd like to set your story in Helvetica, you might use:</p>
<pre><code>Helvetica/Arial/sans-serif 14
</code></pre>
<p>Many people viewing your story using a Windows computer won't have Helvetica available, but they almost certainly will have Arial, Microsoft's <a href="https://ilovetypography.com/2007/10/06/arial-versus-helvetica/">Helvetica competitor</a>, and if for some reason they have neither, the story will use whatever sans serif font is available.</p>
<p>When specifying typefaces that have spaces in their name, you don't need to do anything special:</p>
<pre><code>Times/Times New Roman/serif 20
</code></pre>
<p>You can also modify a font with the words <code>bold</code>, <code>italic</code>, <code>underline</code> or <code>small caps</code>. If you'd like to use multiple styles, just put spaces between them:</p>
<pre><code>Palatino 18 bold italic
</code></pre>
<p>There is a special font style named <code>regular</code>, which removes any bold, italic, underline, or small-cap styling that the font would normally inherit. Font styles <em>must</em> be entered in all-lowercase. This is because you can omit parts of the declaration. All of the below are valid font notations:</p>
<ul>
<li><code>Palatino</code></li>
<li><code>18</code></li>
<li><code>bold italic</code></li>
<li><code>Palatino bold</code></li>
<li><code>18 small caps</code></li>
</ul>
<p>The omitted parts are inherited as described above.</p>
<h2 id="colors"><a class="header" href="#colors">Colors</a></h2>
<p>{% hint style=&quot;info&quot; %}
Applies to: </p>
<ul>
<li><code>config.style.backdrop</code></li>
<li><code>config.style.page.color</code></li>
<li><code>config.style.page.link.color</code></li>
<li><code>config.style.page.link.lineColor</code></li>
<li><code>config.style.page.link.active.color</code></li>
<li><code>config.style.page.link.active.lineColor</code></li>
<li><code>config.style.page.color</code></li>
<li><code>config.style.page.link.color</code></li>
<li><code>config.style.page.link.lineColor</code></li>
<li><code>config.style.page.link.active.color</code></li>
<li><code>config.style.page.link.active.lineColor</code>
{% endhint %}</li>
</ul>
<p>Although you don't have to use it, Chapbook has a built-in color palette called <a href="https://yeun.github.io/open-color/">Open Color</a>. It has a versatile range of hues that are designed to harmonize with each other.</p>
<p>Besides <code>black</code> and <code>white</code>, Open Color has 13 base hues:</p>
<div class="swatch-row last">
<div class="swatch" style="background: #212529">gray</div>
<div class="swatch" style="background: #c92a2a">red</div>
<div class="swatch" style="background: #a61e4d">pink</div>
<div class="swatch" style="background: #862e9c">grape</div>
<div class="swatch" style="background: #5f3dc4">violet</div>
<div class="swatch" style="background: #5f3dc4">indigo</div>
<div class="swatch" style="background: #1864ab">blue</div>
<div class="swatch" style="background: #0b7285">cyan</div>
<div class="swatch" style="background: #087f5b">teal</div>
<div class="swatch" style="background: #2b8a3e">green</div>
<div class="swatch" style="background: #5c940d">lime</div>
<div class="swatch" style="background: #e67700">yellow</div>
<div class="swatch" style="background: #d9480f">orange</div>
</div>
<p>To use them, enter the appropriate name. Open Color also offers 10 shades per hue:</p>
<div class="swatch-row light">
<div class="swatch" style="background: #f8f9fa">gray-0</div>
<div class="swatch" style="background: #fff5f5">red-0</div>
<div class="swatch" style="background: #fff0f6">pink-0</div>
<div class="swatch" style="background: #f8f0fc">grape-0</div>
<div class="swatch" style="background: #f3f0ff">violet-0</div>
<div class="swatch" style="background: #edf2ff">indigo-0</div>
<div class="swatch" style="background: #e7f5ff">blue-0</div>
<div class="swatch" style="background: #e3fafc">cyan-0</div>
<div class="swatch" style="background: #e6fcf5">teal-0</div>
<div class="swatch" style="background: #ebfbee">green-0</div>
<div class="swatch" style="background: #f4fce3">lime-0</div>
<div class="swatch" style="background: #fff9db">yellow-0</div>
<div class="swatch" style="background: #fff4e6">orange-0</div>
</div>
<div class="swatch-row light">
<div class="swatch" style="background: #f1f3f5">gray-1</div>
<div class="swatch" style="background: #ffe3e3">red-1</div>
<div class="swatch" style="background: #ffdeeb">pink-1</div>
<div class="swatch" style="background: #f3d9fa">grape-1</div>
<div class="swatch" style="background: #e5dbff">violet-1</div>
<div class="swatch" style="background: #dbe4ff">indigo-1</div>
<div class="swatch" style="background: #d0ebff">blue-1</div>
<div class="swatch" style="background: #c5f6fa">cyan-1</div>
<div class="swatch" style="background: #c3fae8">teal-1</div>
<div class="swatch" style="background: #d3f9d8">green-1</div>
<div class="swatch" style="background: #e9fac8">lime-1</div>
<div class="swatch" style="background: #fff3bf">yellow-1</div>
<div class="swatch" style="background: #ffe8cc">orange-1</div>
</div>
<div class="swatch-row light">
<div class="swatch" style="background: #e9ecef">gray-2</div>
<div class="swatch" style="background: #ffc9c9">red-2</div>
<div class="swatch" style="background: #fcc2d7">pink-2</div>
<div class="swatch" style="background: #eebefa">grape-2</div>
<div class="swatch" style="background: #d0bfff">violet-2</div>
<div class="swatch" style="background: #bac8ff">indigo-2</div>
<div class="swatch" style="background: #a5d8ff">blue-2</div>
<div class="swatch" style="background: #99e9f2">cyan-2</div>
<div class="swatch" style="background: #96f2d7">teal-2</div>
<div class="swatch" style="background: #b2f2bb">green-2</div>
<div class="swatch" style="background: #d8f5a2">lime-2</div>
<div class="swatch" style="background: #ffec99">yellow-2</div>
<div class="swatch" style="background: #ffd8a8">orange-2</div>
</div>
<div class="swatch-row light">
<div class="swatch" style="background: #dee2e6">gray-3</div>
<div class="swatch" style="background: #ffa8a8">red-3</div>
<div class="swatch" style="background: #faa2c1">pink-3</div>
<div class="swatch" style="background: #e599f7">grape-3</div>
<div class="swatch" style="background: #b197fc">violet-3</div>
<div class="swatch" style="background: #91a7ff">indigo-3</div>
<div class="swatch" style="background: #74c0fc">blue-3</div>
<div class="swatch" style="background: #66d9e8">cyan-3</div>
<div class="swatch" style="background: #63e6be">teal-3</div>
<div class="swatch" style="background: #8ce99a">green-3</div>
<div class="swatch" style="background: #c0eb75">lime-3</div>
<div class="swatch" style="background: #ffe066">yellow-3</div>
<div class="swatch" style="background: #ffc078">orange-3</div>
</div>
<div class="swatch-row">
<div class="swatch" style="background: #ced4da">gray-4</div>
<div class="swatch" style="background: #ff8787">red-4</div>
<div class="swatch" style="background: #f783ac">pink-4</div>
<div class="swatch" style="background: #da77f2">grape-4</div>
<div class="swatch" style="background: #9775fa">violet-4</div>
<div class="swatch" style="background: #748ffc">indigo-4</div>
<div class="swatch" style="background: #4dabf7">blue-4</div>
<div class="swatch" style="background: #3bc9db">cyan-4</div>
<div class="swatch" style="background: #38d9a9">teal-4</div>
<div class="swatch" style="background: #69db7c">green-4</div>
<div class="swatch" style="background: #a9e34b">lime-4</div>
<div class="swatch" style="background: #ffd43b">yellow-4</div>
<div class="swatch" style="background: #ffa94d">orange-4</div>
</div>
<div class="swatch-row">
<div class="swatch" style="background: #adb5bd">gray-5</div>
<div class="swatch" style="background: #ff6b6b">red-5</div>
<div class="swatch" style="background: #f06595">pink-5</div>
<div class="swatch" style="background: #cc5de8">grape-5</div>
<div class="swatch" style="background: #845ef7">violet-5</div>
<div class="swatch" style="background: #5c7cfa">indigo-5</div>
<div class="swatch" style="background: #339af0">blue-5</div>
<div class="swatch" style="background: #22b8cf">cyan-5</div>
<div class="swatch" style="background: #20c997">teal-5</div>
<div class="swatch" style="background: #51cf66">green-5</div>
<div class="swatch" style="background: #94d82d">lime-5</div>
<div class="swatch" style="background: #fcc419">yellow-5</div>
<div class="swatch" style="background: #ff922b">orange-5</div>
</div>
<div class="swatch-row">
<div class="swatch" style="background: #868e96">gray-6</div>
<div class="swatch" style="background: #fa5252">red-6</div>
<div class="swatch" style="background: #e64980">pink-6</div>
<div class="swatch" style="background: #be4bdb">grape-6</div>
<div class="swatch" style="background: #7950f2">violet-6</div>
<div class="swatch" style="background: #4c6ef5">indigo-6</div>
<div class="swatch" style="background: #228be6">blue-6</div>
<div class="swatch" style="background: #15aabf">cyan-6</div>
<div class="swatch" style="background: #12b886">teal-6</div>
<div class="swatch" style="background: #40c057">green-6</div>
<div class="swatch" style="background: #82c91e">lime-6</div>
<div class="swatch" style="background: #fab005">yellow-6</div>
<div class="swatch" style="background: #fd7e14">orange-6</div>
</div>
<div class="swatch-row">
<div class="swatch" style="background: #495057">gray-7</div>
<div class="swatch" style="background: #f03e3e">red-7</div>
<div class="swatch" style="background: #d6336c">pink-7</div>
<div class="swatch" style="background: #ae3ec9">grape-7</div>
<div class="swatch" style="background: #7048e8">violet-7</div>
<div class="swatch" style="background: #4263eb">indigo-7</div>
<div class="swatch" style="background: #1c7ed6">blue-7</div>
<div class="swatch" style="background: #1098ad">cyan-7</div>
<div class="swatch" style="background: #0ca678">teal-7</div>
<div class="swatch" style="background: #37b24d">green-7</div>
<div class="swatch" style="background: #74b816">lime-7</div>
<div class="swatch" style="background: #f59f00">yellow-7</div>
<div class="swatch" style="background: #f76707">orange-7</div>
</div>
<div class="swatch-row">
<div class="swatch" style="background: #343a40">gray-8</div>
<div class="swatch" style="background: #e03131">red-8</div>
<div class="swatch" style="background: #c2255c">pink-8</div>
<div class="swatch" style="background: #9c36b5">grape-8</div>
<div class="swatch" style="background: #6741d9">violet-8</div>
<div class="swatch" style="background: #3b5bdb">indigo-8</div>
<div class="swatch" style="background: #1971c2">blue-8</div>
<div class="swatch" style="background: #0c8599">cyan-8</div>
<div class="swatch" style="background: #099268">teal-8</div>
<div class="swatch" style="background: #2f9e44">green-8</div>
<div class="swatch" style="background: #66a80f">lime-8</div>
<div class="swatch" style="background: #f08c00">yellow-8</div>
<div class="swatch" style="background: #e8590c">orange-8</div>
</div>
<div class="swatch-row last">
<div class="swatch" style="background: #212529">gray-9</div>
<div class="swatch" style="background: #c92a2a">red-9</div>
<div class="swatch" style="background: #a61e4d">pink-9</div>
<div class="swatch" style="background: #862e9c">grape-9</div>
<div class="swatch" style="background: #5f3dc4">violet-9</div>
<div class="swatch" style="background: #364fc7">indigo-9</div>
<div class="swatch" style="background: #1864ab">blue-9</div>
<div class="swatch" style="background: #0b7285">cyan-9</div>
<div class="swatch" style="background: #087f5b">teal-9</div>
<div class="swatch" style="background: #2b8a3e">green-9</div>
<div class="swatch" style="background: #5c940d">lime-9</div>
<div class="swatch" style="background: #e67700">yellow-9</div>
<div class="swatch" style="background: #d9480f">orange-9</div>
</div>
<p>As above, to use a particular shade, enter the name in its box, e.g. <code>yellow-6</code>. You can also use <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Applying_color#How_to_describe_a_color">any other color notation</a> that web browsers understand, from the traditional hex triplet notation (e.g. <code>#0b7285</code>) to more modern ones, such as <code>hsla(0%, 65%, 48%, 0.75)</code>.</p>
<p>When setting colors in <code>config</code>, often you can specify both a background and foreground. For instance, you can set <code>config.style.page.color</code> to <code>'orange-9 on orange-0'</code>. However, when specifying a border color, for instance <code>config.style.page.link.lineColor</code>, only the foreground is used.</p>
<p>As with fonts, you can omit parts of a color declaration. Setting <code>config.style.page.link.color</code> to <code>'on blue-4'</code> causes links to use the page's foreground color, whatever it may be, but use a medium blue as background.</p>
<style>
.page-diagram {
	width: 20vw;
	height: 50vh;
	border: 1px solid black;
	margin: 1em auto;
	font-style: italic;
	text-align: center;
	display: flex;
	flex-direction: column;
}

.page-diagram .header {
	border-bottom: 1px solid black;
}

.page-diagram .content {
	flex-grow: 1;
	display: flex;
	align-items: center;
	justify-content: center;
}

.page-diagram .footer {
	border-top: 1px solid black;
}

.swatch-row {
	display: flex;
	height: 50px;
}

.swatch-row.last {
	margin-bottom: 1em;
}

.swatch {
	flex-grow: 1;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	color: white;
	font-size: 80%;
}

.swatch-row.light .swatch {
	color: black;
}
</style>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>To review, launching your story with Twine's <strong>Test</strong> button will cause the backstage view to appear, including the <strong>Style</strong> tab.</p>
</div>
<div class="footnote-definition" id="2"><sup class="footnote-definition-label">2</sup>
<p>If you are familiar with <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/length">CSS units</a>, you can also use them, e.g. <code>Palatino 1rem</code> or <code>Palatino 25%</code>.</p>
</div>
<div class="footnote-definition" id="3"><sup class="footnote-definition-label">3</sup>
<p>What's a serif? <a href="https://en.wikipedia.org/wiki/Serif">Wikipedia</a> aptly answers.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="external-web-fonts"><a class="header" href="#external-web-fonts">External Web Fonts</a></h1>
<p>Creating a good font stack is difficult because there are very few typefaces you can count on a majority of your players having installed. Fortunately, you aren't limited to what your players happen to have installed--instead, you can use web fonts.</p>
<h2 id="using-google-fonts"><a class="header" href="#using-google-fonts">Using Google Fonts</a></h2>
<p>Google provides a wide variety of freely-usable fonts through their <a href="https://fonts.google.com">Google Fonts</a> service. To use Google Fonts in your story, first find the embed code for the families you wish to use:</p>
<p style="text-align: center">
<img src="customization/google-font.png" width="300" height="198" alt="Google Fonts screenshot">
</p>
<p>Copy the embed code that Google Fonts offers you, i.e. <code>&lt;link href=&quot;https://fonts.googleapis.com/css?family=Open+Sans&quot; rel=&quot;stylesheet&quot;&gt; </code>, and set the variable <code>config.style.googleFont</code> to it in your first passage. You can then use the font name anywhere in the rest of <code>config.style</code> as usual:</p>
<pre><code>config.style.googleFont: '&lt;link href=&quot;https://fonts.googleapis.com/css?family=Open+Sans&quot; rel=&quot;stylesheet&quot;&gt;'
config.style.page.font: 'Open Sans/sans-serif 18'
--
Welcome aboard the U.S.S. Hood.
</code></pre>
<p>Note that because <code>config.style.googleFont</code> is a string, you must put single quotes around its value. (It's much easier to type single quotes here, since the embed code has double quotes in it.)</p>
<h2 id="using-adobe-typekit-fonts"><a class="header" href="#using-adobe-typekit-fonts">Using Adobe Typekit Fonts</a></h2>
<p>Adobe Typekit serves a similar purpose to Google Fonts, but most of its collection requires an Adobe Creative Cloud subscription to use. That said, it does permit free use of some of its font families.</p>
<p>Once you've assembled a kit--Adobe's terminology for one or more font families you plan to use--find its embed code in Typekit.</p>
<p style="text-align: center">
<img src="customization/typekit-font.png" width="300" height="152" alt="Typekit screenshot">
</p>
<p>Copy the default code, i.e. <code>&lt;link rel=&quot;stylesheet&quot; href=&quot;https://use.typekit.net/abcdefgh.css&quot;&gt;</code>, and set the variable <code>config.style.typekitFont</code> to it in your first passage. As with Google Fonts, you can then use the font name anywhere in the rest of <code>config.style</code>.</p>
<pre><code>config.style.typekitFont: '&lt;link rel=&quot;stylesheet&quot; href=&quot;https://use.typekit.net/abdefgh.css&quot;&gt;'
config.style.page.font: 'Open Sans/sans-serif 18'
--
Welcome aboard the U.S.S. Hood.
</code></pre>
<h2 id="other-web-fonts"><a class="header" href="#other-web-fonts">Other Web Fonts</a></h2>
<p>You can also use web fonts separately from a cloud service. Please make sure to check the license for the font; it's not uncommon, for example, to be required to pay a certain fee to use a font for personal use, but a different for use on the web, or in an app.</p>
<p>To include a font directly by URL, add two properties to <code>config.style.fonts</code>:</p>
<pre><code>config.style.fonts.leagueSpartan.url: 'league-spartan.woff2'
config.style.fonts.leagueSpartan.name: 'League Spartan'
config.style.page.font: 'League Spartan/sans-serif 16'
--
It is the year 1969, and you are walking on the moon.
</code></pre>
<p>Chapbook can't infer the name of the font from the <code>url</code> property, so you must tell it what it is.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="page-style"><a class="header" href="#page-style">Page Style</a></h1>
<p>On sufficiently wide web browser windows, Chapbook will add horizontal margins around the text of your story so that it's comfortable to read. The exact width of the text column is based upon the font size that's set in <code>config.style.page.font</code>. You can control the appearance around the text through several variables.</p>
<p>First, the variable <code>config.style.page.style</code> takes one of several possible values:</p>
<ul>
<li><code>'none'</code> creates no visible border around the page content</li>
<li><code>'thin-line'</code> and <code>'thick-line'</code> create flat borders around the content</li>
<li><code>'shadow'</code> adds a drop shadow around the content.</li>
</ul>
<p>Chapbook's default appearance is <code>'shadow'</code>.</p>
<p>If you use <code>'thin-line'</code> or <code>'thick-line'</code>, you can specify the color of the line using the variable <code>config.style.page.borderColor</code>. This should be set to a single <a href="customization/fonts-and-colors.html#colors">color</a>.</p>
<p>The variable <code>config.backdrop</code> sets the <a href="customization/fonts-and-colors.html#colors">color</a> of the area around the text content. On smaller browser windows (especially mobile devices), this area is not visible, however.</p>
<p>When the story shows a new passage, it creates a transition between text based on what is set in the <code>config.body.transition.name</code> variable:</p>
<ul>
<li><code>'crossfade'</code> causes the old text to fade out at the same time that the new text fades in</li>
<li><code>'fadeInOut'</code> causes the old text to fade out, then the new text to fade in</li>
<li><code>'none'</code> causes the new text to replace the old text immediately</li>
</ul>
<p>Chapbook's default transition is <code>'crossfade'</code>.</p>
<p>If you use <code>'crossfade'</code> or <code>'fadeInOut'</code>, you can control how long the transition takes by setting <code>config.body.transition.duration</code>, which should be a string in the same format that the <a href="customization/../text-and-links/modifiers-and-delayed-text.html">after modifer</a> accepts. Remember that it doesn't understand decimals, so if you'd like a transition to take half a second, set <code>config.page.transition.duration</code> to <code>'500ms'</code>. Also keep in mind that the duration is the duration of the complete transition-- a <code>'crossfade'</code> and <code>'fadeInOut'</code> transition with the same duration might look as though they last different amounts of time, as the <code>'fadeInOut'</code> has two steps.</p>
<p>You can also set how the header and footer content update using the following variables. They take the same values as their <code>body</code> counterparts.</p>
<ul>
<li><code>config.header.transition.name</code></li>
<li><code>config.header.transition.duration</code></li>
<li><code>config.footer.transition.name</code></li>
<li><code>config.footer.transition.duration</code></li>
</ul>
<p>Finally, Chapbook vertically centers text inside the page by default. To change this, set <code>config.style.page.verticalAlign</code> to either <code>'top'</code>, <code>'center'</code>, or <code>'bottom'</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fork-style"><a class="header" href="#fork-style">Fork Style</a></h1>
<p>The way <a href="customization/../text-and-links/forks.html">forks</a> display can be customized through several variables.</p>
<p>First, <code>config.style.page.fork.divider.style</code> sets the style of the dividing line between links. It can be set to any of these values:</p>
<ul>
<li><code>dashed</code></li>
<li><code>dotted</code></li>
<li><code>double</code>, which displays two thin horizontal lines</li>
<li><code>solid</code></li>
<li><code>none</code>, which hides the dividers completely</li>
</ul>
<p><code>config.style.page.fork.divider.size</code> sets the thickness of the dividing line, and <code>config.style.page.fork.divider.color</code> sets its color.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="design-considerations"><a class="header" href="#design-considerations">Design Considerations</a></h1>
<p>Players will spend quite a lot of time with your story simply reading its text, so they deserve a well-considered experience. Which is not to say the experience should always be comfortable. Cara Ellison's <em><a href="https://unwinnable.com/2013/04/25/play-at-heartbreaking-with-cara-ellison/">Sacrilege</a></em> has a searing purple background for its text and bright yellow links that turn green when you point at them, but all this is in service to its content. <em>Sacrilege's</em> story is, in part, about the sensory overload of a nightclub, so it's fitting that the text itself somewhat overload the player's senses.<sup class="footnote-reference"><a href="#1">1</a></sup></p>
<p>Fortunately, people have been designing reading experiences for centuries now, and there's quite a lot of accumulated wisdom on how to use type gracefully.</p>
<ul>
<li>
<p>If you're new to typography, the best first port of call is Matthew
Butterick's <a href="https://practicaltypography.com/">Practical Typography</a>. Butterick is
opinionated and a bit patrician in some of his pronouncements, but his basic
ideas are sound, and he takes the <em>Practical</em> part of the name of his web
site seriously.</p>
</li>
<li>
<p>The Yale Web Style Guide's <a href="https://webstyleguide.com/9-typography.html">chapter on typography</a> is also
worth reading, though it is intended for web designers and developers, who
must build pages from the ground up.</p>
</li>
<li>
<p>If you find yourself truly intrigued by typography, it's worth tracking down
a copy of <em><a href="https://en.wikipedia.org/wiki/The_Elements_of_Typographic_Style">The Elements of Typographical Style</a></em>.</p>
</li>
</ul>
<p>There is also a strange kind of science to selecting colors.</p>
<ul>
<li>If you've never delved into color theory, try starting  with with the <a href="https://programmingdesignsystems.com/color/color-scheme">Color
Schemes</a> chapter of Rune Madsen's <em>Programming Design
Systems</em>. It uses code examples using a programming language called
<a href="https://processing.org/">Processing</a>, but you can safely skim over them. If you find
yourself intrigued by the subject, try the rest of Madsen's section on
color.</li>
<li>Khan Academy has a free <a href="https://www.khanacademy.org/partner-content/pixar/color">online course on the science of color</a>
that talks about both how our eyes and brains perceive color, and the
different color models used to represent color.</li>
<li>There's no substitute for simply playing with color. The best tool online
for this is perhaps <a href="https://color.adobe.com/create/color-wheel/">Adobe Color CC</a>, which is beginning to
show its age but is still useful.</li>
<li>WebAIM has a <a href="https://webaim.org/resources/contrastchecker/">contrast checker</a> that ensures that the color
scheme you design has sufficient contrast for low-vision players. Your colors should pass the WCAG AAA criteria for normal text.</li>
</ul>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>Try playing it, even for a little, then go back to the plain-jane white background of a typical web site. You'll see afterimages.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><div class="intro input">
    <h1 id="player-input"><a class="header" href="#player-input">Player Input</a></h1>
</div>
<p>This section describes how to ask the player for input, including text fields, dropdown menus, and cycling links.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="text-input"><a class="header" href="#text-input">Text Input</a></h1>
<p>Sometimes selecting a link isn't expressive enough to capture player intent. One common scenario is allowing the player to name a character--often, the protagonist. To do this, use the <code>{text input}</code> insert.</p>
<pre><code>What would you like to name your loyal canine companion?

{text input for: 'dogName'}

[[Continue]]
</code></pre>
<p>This displays a text field after the first paragraph that, once the player moves to another passage, saves its contents to the variable named <code>dogName</code>. Take careful note of the quotation marks around <code>'dogName'</code> in the insert. These are needed so that the variable name is passed as-is to the insert, instead of being evaluated. Consider this contrived passage:</p>
<pre><code>petType: 'cat'
--
What would you like to name your loyal {petType} companion?

{text input for: petType}

[[Continue]]
</code></pre>
<p>This would save what the player entered to a variable named <code>cat</code>, not <code>petType</code>, because the variable <code>petType</code> is evaluated by the insert.</p>
<p>If the variable that the text input is saving to already has a value, the text input will start with that value already filled in. For example:</p>
<pre><code>dogName: 'Lassie'
--
What would you like to name your loyal canine companion?

{text input for: 'dogName'}

[[Continue]]
</code></pre>
<p>Will suggest a default name of 'Lassie' for the player's dog.</p>
<p>Unless you specify otherwise, players must enter some text into a text input before moving onto another passage. If navigation is blocked, the player's web browser will show a message highlighting the text input that's empty. The exact appearance of this message varies from browser to browser, and can't be customized.</p>
<h2 id="optional-parts"><a class="header" href="#optional-parts">Optional Parts</a></h2>
<p>To allow the player to skip entering anything into a text input, set the insert's <code>required</code> property to <code>false</code>.</p>
<pre><code>What's your darkest secret? You don't have to tell me now if you don't want to.

{text input for: 'secret', required: false}
</code></pre>
<p>Note that as above, the variable name should be quoted, but <code>false</code> should not.</p>
<p>{% hint style='info' %}
The restriction on navigation only applies to player-initiated navigation. A required text input will not block navigation initiated by the story itself, or the player choosing to restart the story.
{% endhint %}</p>
<p>You also do not have to save a text input's value to a variable, if for some reason you won't need the value later. To do this, write <code>{text input}</code> or <code>{text input, required: true}</code>. </p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dropdown-menus-and-cycling-links"><a class="header" href="#dropdown-menus-and-cycling-links">Dropdown Menus and Cycling Links</a></h1>
<p>Instead of allowing any kind of input at all from a player, you may want to contrain them to a specific set of choices. Chapbook has two mechanisms for this that look different to the player, but behave identically behind the scenes: menus and cycling links.</p>
<p>In order to do this, we need to introduce a new type of variable, an <em>array</em>. An array is similar to an object<sup class="footnote-reference"><a href="#1">1</a></sup> in that it's a container for other variables. However, where objects contain named variables, arrays are simply an ordered list of values. This array lists the colors of the rainbow:</p>
<pre><code>['red', 'orange', 'yellow', 'green', 'blue', 'indigo', 'violet']
</code></pre>
<p>Arrays are easy to spot: they simply put square brackets around a list of values separated by commas. An array can contain any type of value: <code>['red', 3, true]</code> is a valid array. Arrays can also be empty, though in practice you'll rarely encounter this. The way to express an empty array is by writing <code>[]</code>.</p>
<h2 id="dropdown-menus"><a class="header" href="#dropdown-menus">Dropdown Menus</a></h2>
<p>The <code>{dropdown menu}</code> insert displays a menu of choices to the player.</p>
<pre><code>What meal do you enjoy most?

{dropdown menu for: 'meal', choices: ['Breakfast', 'Lunch', 'Dinner']}
</code></pre>
<p>As with text inputs, <code>{dropdown menu}</code> inserts save the selected value to a variable--in the example above, a variable named <code>meal</code>. If <code>meal</code> were previously set to a value in the menu, that value will be automatically preselected for the player. Otherwise, the menu shows the first option you list in the array of choices.</p>
<p>Unlike a text input, a dropdown menu does not block navigation to another passage, since it always has some value set.</p>
<h2 id="cycling-links-1"><a class="header" href="#cycling-links-1">Cycling Links</a></h2>
<p>The <code>{cycling link}</code> insert works exactly the same way as <code>{dropdown menu}</code>, only it shows a text link that the player selects to change. As the name implies, when the player reaches the last value in the <code>choices</code> array, the link starts over at the first element in the array.</p>
<pre><code>I enjoy {cycling link for: 'meal', choices: ['Breakfast', 'Lunch', 'Dinner']} the most.
</code></pre>
<h2 id="optional-parts-1"><a class="header" href="#optional-parts-1">Optional Parts</a></h2>
<p>Just like text inputs, dropdown menus and cycling links don't require that their value be saved to a variable. To do this, omit the <code>for:</code> part of the insert. For example, <code>{cycling link, choices: ['Breakfast', 'Lunch', 'Dinner']}</code>.</p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>It is a peculiarity of JavaScript, the programming language of web browsers, that arrays are in fact implemented as objects, so in a sense arrays <em>are</em> objects. However, it's best to think of them at this stage as a distinct concept.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><div class="intro advanced">
    <h1 id="advanced-topics"><a class="header" href="#advanced-topics">Advanced Topics</a></h1>
</div>
<p>This section covers topics that require existing knowledge of Web technologies such as JavaScript and CSS. Learning these is more than this documentation can handle; the <a href="https://developer.mozilla.org/en-US/">Mozilla Developer Network</a> is one place to start if you're interested in learning.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="using-javascript-in-passages"><a class="header" href="#using-javascript-in-passages">Using JavaScript in Passages</a></h1>
<p>As a last resort, Chapbook allows you to mix JavaScript into the text of your passage. To do this, use a <code>[JavaScript]</code> modifier:</p>
<pre><code>[JavaScript]
document.title = 'A Sticky Pickle';

[continued]
&quot;Oh dear,&quot; you think to yourself. &quot;That stain will never come out.&quot;
</code></pre>
<p>The JavaScript modifier normally does not output anything in Chapbook; however, if you would like to output text, the modifier provides a function <code>write()</code>--just plain <code>write()</code>, not <code>document.write()</code>--that will output HTML source code. Text output via <code>write()</code> <em>will</em> be processed for links and Markdown.</p>
<p>Below is an example showing how <code>write()</code> works:</p>
<pre><code>Before you lose your temper, you count to yourself:

[JavaScript]
for (let i = 1; i &lt;= 10; i++) {
	write(i + '... ');
}
</code></pre>
<p>You can refer to variables defined in vars sections as you would expect in JavaScript. Changing them in JavaScript will persist changes as you'd expect, as well.</p>
<pre><code>color: 'red
--
[JavaScript]
write(`The sky is ${color}.`);
</code></pre>
<p>As a result, if you would like your JavaScript code to communicate back with the rest of your story, the easiest way to do this is to set the variable to an initial value in a vars section. If you absolutely need to create new variables in JavaScript, you can call <code>engine.state.set()</code> as below. This usage may change in future versions of Chapbook, though, whereas setting a variable initially in a vars section will always work.</p>
<pre><code>[JavaScript]
let color = 'red';
engine.state.set('weather', 'sunny');

[continued]
It was a {weather} day. The sky was {color}.
</code></pre>
<p>This would display:</p>
<blockquote>
<p>It was a sunny day. The sky was {color}.</p>
</blockquote>
<p><code>{color}</code> is displayed as-is because if Chapbook cannot find a matching insert or variable name, it displays the source text as it was entered. Any variables declared using <code>let</code> or <code>const</code> will <em>not</em> be visible to other Chapbook code, and will not be persisted across browser sessions.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="using-css-in-passages"><a class="header" href="#using-css-in-passages">Using CSS in Passages</a></h1>
<p>Most of the time, the best way to customize the appearance of your story is to use <a href="advanced/../customization">Chapbook's built-in functionality</a> or the <em>Edit Stylesheet</em> menu item in Twine. However, it is also possible to create passage-specific CSS using the <code>[CSS]</code> modifier.</p>
<pre><code>[CSS]
.page article {
	color: green;
}

[continued]
This text will be in green.
</code></pre>
<p>The CSS in this modifier will be applied globally--hence why the <code>.page article</code> selector is needed.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="adding-custom-inserts"><a class="header" href="#adding-custom-inserts">Adding Custom Inserts</a></h1>
<p>Chapbook can be extended with custom inserts. Below is code that adds a <code>{smiley face}</code> insert that displays a 😀 emoji.</p>
<pre><code>[JavaScript]
engine.extend('1.0.0', () =&gt; {
	config.template.inserts = [{
		match: /^smiley face$/i,
		render: () =&gt; '😀'
	}, ...config.template.inserts];
});
</code></pre>
<p>You can also place code like this into your story's JavaScript in Twine--this uses the <code>[JavaScript]</code> modifier for clarity.<sup class="footnote-reference"><a href="#1">1</a></sup></p>
<p>First, any extension of the Chapbook engine must be wrapped in a <code>engine.extend()</code> function call. The first argument is the minimum version of Chapbook required to make your insert work; this is so that if you share your customization, anyone plugging it into a Chapbook version it won't work in will receive a harmless warning, instead of the engine crashing with an error. Chapbook follows [semantic versioning] to assist with this.</p>
<p>The second argument to <code>engine.extend()</code> is the customization code you'd like to run. In this function, we add a new insert to <code>config.template.inserts</code> using [array spread syntax]. Every item in <code>config.template.inserts</code> must be an object with two properties:</p>
<ul>
<li><code>match</code>: a regular expression that the template engine will look for to render your insert. Leave out the curly braces; the template engine will take care of this for you. Inserts must always have at least one space in their <code>match</code> property, so that they can never be mistaken for a variable insert.</li>
<li><code>render</code>: a function that returns a string for what should be displayed. The returned value will be eventually rendered as Markdown.</li>
</ul>
<p>{% hint style='danger' %}
Do not mutate <code>config.template.inserts</code> directly, e.g. with <code>config.template.inserts.push()</code> or direct assignment. Doing so may cause incorrect behavior.
{% endhint %}</p>
<p>You may remember that inserts <a href="advanced/../modifiers-and-inserts/link-inserts.html">can take multiple parameters</a>. Here's a more complex example that demonstrates this:</p>
<pre><code>[JavaScript]
engine.extend('1.0.0', () =&gt; {
	config.template.inserts = [{
		match: /^icon of/i,
		render(firstArg, props, invocation) {
			let result = '';

			if (firstArg.toLowerCase() === 'wizard') {
				result = '🧙';
			}

			if (firstArg.toLowerCase() === 'vampire') {
				result = '🧛';
			}

			switch (props.mood.toLowerCase()) {
				case 'anger':
					result += '💥';
					break;

				case 'love':
					result += '❤️';
					break;
			}

			return result;
		}
	}, ...config.template.inserts];
});
</code></pre>
<p>This has the following effect:</p>
<div class="table-wrapper"><table><thead><tr><th>Typed</th><th>Displayed</th></tr></thead><tbody>
<tr><td><code>{icon of: 'wizard'}</code></td><td>🧙</td></tr>
<tr><td><code>{icon of: 'wizard', mood: 'anger'}</code></td><td>🧙💥</td></tr>
<tr><td><code>{icon of: 'wizard', mood: 'love'}</code></td><td>🧙❤️</td></tr>
<tr><td><code>{icon of: 'vampire'}</code></td><td>🧛</td></tr>
<tr><td><code>{icon of: 'vampire', mood: 'anger'}</code></td><td>🧛💥</td></tr>
<tr><td><code>{icon of: 'vampire', mood: 'love'}</code></td><td>🧛❤️</td></tr>
</tbody></table>
</div>
<p>First, notice that the <code>match</code> property doesn't try to match the entire insert; it just needs to be able to distinguish this insert from any other entered. Also, remember that the first part of the insert needed to be two words, <code>icon of</code>, to distinguish it from a variable insert.</p>
<p>Then, the <code>render()</code> property takes three new arguments, <code>firstArg</code>, <code>props</code>, and <code>invocation</code>. <code>firstArg</code> is the parameter given to the first part of the insert, and <code>props</code> is an object listing out all other parameters given in the insert. The names of properties are case-sensitive, so <code>{icon of: 'wizard', Mood: 'anger'}</code> would only display 🧙. The final argument, <code>invocation</code>, is the entire text of the insert exactly as it was typed, except for the surrounding curly braces. This is provided so that if neither <code>firstArg</code> or <code>props</code> is enough to achieve the effect you're looking for, you can look at <code>invocation</code> directly.</p>
<p>Below are some examples as to how these arguments work in practice.</p>
<div class="table-wrapper"><table><thead><tr><th>Typed</th><th>firstArg</th><th>props</th><th>invocation</th></tr></thead><tbody>
<tr><td><code>{smiley face}</code></td><td><code>null</code></td><td><code>{}</code></td><td><code>smiley face</code></td></tr>
<tr><td><code>{smiley face: 'happy'}</code></td><td><code>'happy'</code></td><td><code>{}</code></td><td><code>smiley face: 'happy'</code></td></tr>
<tr><td><code>{smiley face, size: 'large'}</code></td><td><code>null</code></td><td><code>{size: 'large'}</code></td><td><code>smiley face, size: 'large'</code></td></tr>
<tr><td><code>{smiley face: 'happy', size: 'large'}</code></td><td><code>'happy'</code></td><td><code>{size: 'large'}</code></td><td><code>smiley face: 'happy', size: 'large'</code></td></tr>
</tbody></table>
</div>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>Word of warning--you cannot define an insert in the same passage that you use it in.
[semantic versioning]: https://semver.org/
[array spread syntax]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax#Spread_in_array_literals</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="adding-custom-modifiers"><a class="header" href="#adding-custom-modifiers">Adding Custom Modifiers</a></h1>
<p>Chapbook can also be extended with custom modifiers. Below is code that adds a modifier that turns its text uppercase:</p>
<pre><code>[JavaScript]
engine.extend('1.0.0', () =&gt; {
	config.template.modifiers = [{
		match: /^uppercase$/i,
		process(output) {
			output.text = output.text.toUpperCase();
		}
	}, ...config.template.modifiers];
});
</code></pre>
<p>You can also place code like this into your story's JavaScript in Twine--this uses the <code>[JavaScript]</code> modifier for clarity.<sup class="footnote-reference"><a href="#1">1</a></sup></p>
<p>See <a href="advanced/adding-custom-inserts.html">the first part of Adding Custom Inserts</a> for an explanation of the <code>engine.extend()</code> function call, and how <code>config.template.modifiers</code> is changed. The <code>match</code> property works the same way as the <code>match</code> property for an insert; Chapbook compares possible modifier text with <code>match</code> properties until it finds a match.</p>
<p>The <code>process()</code> property is where the work of a modifier occurs. The <code>output</code> argument it is passed has three properties. Each one is Markdown source code, <em>not</em> HTML as it will be finally rendered.</p>
<ul>
<li><code>text</code>, the text that the modifier is being applied to.</li>
<li><code>startsNewParagraph</code>, a Boolean value indicating whether this block of text should begin a new paragraph. (The [append modifier], for example, sets this to <code>false</code>.)</li>
</ul>
<p>Modifiers also receive two other arguments which the example above didn't show:</p>
<ul>
<li><code>state</code>, a private state object that is carried over invocations of a modifier in a single passage</li>
<li><code>invocation</code>, the exact text that was typed in the modifier, without the square brackets surrounding it</li>
</ul>
<p>Below is an example showing how <code>state</code> and <code>invocation</code> can be used to remove more and more letters from a passage.</p>
<pre><code>[JavaScript]
engine.extend('1.0.0', () =&gt; {
	config.template.modifiers = [{
		match: /^(also\b)?remove\b/i,
		process(output, state, invocation) {
			const invokeLetters = invocation.replace(/^(also\b)?remove/, '').split('');

			state.letters = (state.letters || []).concat(invokeLetter);
			state.letters.forEach(letter =&gt; {
				output.text = output.text.replace(new RegExp(letter, 'gi'), 'X');
			});
		}
	}, ...config.template.modifiers];
});
</code></pre>
<p>So that the following passage (from Kurt Vonnegut's <em>Slaughterhouse Five</em>)...</p>
<pre><code>[remove aeiou]
American planes, full of holes and wounded men and corpses took off backwards from an airfield in England. Over France a few German fighter planes flew at them backwards, sucked bullets and shell fragments from some of the planes and crewmen. They did the same for wrecked American bombers on the ground, and those planes flew up backwards to join the formation.

[also remove shrdlu]
The formation flew backwards over a German city that was in flames. The bombers opened their bomb bay doors, exerted a miraculous magnetism which shrunk the fires, gathered them into cylindrical steel containers, and lifted the containers into the bellies of the planes. The containers were stored neatly in racks. The Germans below had miraculous devices of their own, which were long steel tubes. They used them to suck more fragments from the crewmen and planes. But there were still a few wounded Americans, though, and some of the bombers were in bad repair. Over France, though, German fighters came up again, made everything and everybody as good as new.

[also remove t]
When the bombers got back to their base, the steel cylinders were taken from the racks and shipped back to the United States of America, where factories were operating night and day, dismantling the cylinders, separating the dangerous contents into minerals. Touchingly, it was mainly women who did this work. The minerals were then shipped to specialists in remote areas. It was their business to put them into the ground, to hide them cleverly, so they would never hurt anybody ever again.
</code></pre>
<p>... Would display as:</p>
<pre><code>XmXrXcXn plXnXs, fXll Xf hXlXs Xnd wXXndXd mXn Xnd cXrpsXs tXXk Xff bXckwXrds frXm Xn XXrfXXld Xn XnglXnd. XvXr FrXncX X fXw GXrmXn fXghtXr plXnXs flXw Xt thXm bXckwXrds, sXckXd bXllXts Xnd shXll frXgmXnts frXm sXmX Xf thX plXnXs Xnd crXwmXn. ThXy dXd thX sXmX fXr wrXckXd XmXrXcXn bXmbXrs Xn thX grXXnd, Xnd thXsX plXnXs flXw Xp bXckwXrds tX jXXn thX fXrmXtXXn.

TXX fXXmXtXXn fXXw bXckwXXXX XvXX X GXXmXn cXty tXXt wXX Xn fXXmXX. TXX bXmbXXX XpXnXX tXXXX bXmb bXy XXXXX, XxXXtXX X mXXXcXXXXX mXgnXtXXm wXXcX XXXXnk tXX fXXXX, gXtXXXXX tXXm XntX cyXXnXXXcXX XtXXX cXntXXnXXX, XnX XXftXX tXX cXntXXnXXX XntX tXX bXXXXXX Xf tXX pXXnXX. TXX cXntXXnXXX wXXX XtXXXX nXXtXy Xn XXckX. TXX GXXmXnX bXXXw XXX mXXXcXXXXX XXvXcXX Xf tXXXX Xwn, wXXcX wXXX XXng XtXXX tXbXX. TXXy XXXX tXXm tX XXck mXXX fXXgmXntX fXXm tXX cXXwmXn XnX pXXnXX. BXt tXXXX wXXX XtXXX X fXw wXXnXXX XmXXXcXnX, tXXXgX, XnX XXmX Xf tXX bXmbXXX wXXX Xn bXX XXpXXX. XvXX FXXncX, tXXXgX, GXXmXn fXgXtXXX cXmX Xp XgXXn, mXXX XvXXytXXng XnX XvXXybXXy XX gXXX XX nXw.

WXXn XXX bXmbXXX gXX bXck XX XXXXX bXXX, XXX XXXXX cyXXnXXXX wXXX XXkXn fXXm XXX XXckX XnX XXXppXX bXck XX XXX XnXXXX XXXXXX Xf XmXXXcX, wXXXX fXcXXXXXX wXXX XpXXXXXng nXgXX XnX XXy, XXXmXnXXXng XXX cyXXnXXXX, XXpXXXXXng XXX XXngXXXXX cXnXXnXX XnXX mXnXXXXX. XXXcXXngXy, XX wXX mXXnXy wXmXn wXX XXX XXXX wXXk. XXX mXnXXXXX wXXX XXXn XXXppXX XX XpXcXXXXXXX Xn XXmXXX XXXXX. XX wXX XXXXX bXXXnXXX XX pXX XXXm XnXX XXX gXXXnX, XX XXXX XXXm cXXvXXXy, XX XXXy wXXXX nXvXX XXXX XnybXXy XvXX XgXXn.
</code></pre>
<p>Finally, in some cases, you may want a modifier to modify the source text as it was exactly entered by the author, before inserts and links are transformed into Markdown/HTML equivalents. To do this, write a <code>processRaw()</code> function instead of <code>process</code>. It takes the same exact arguments that <code>process()</code> does.</p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>Word of warning--you cannot define a modifier in the same passage that you use it in.
[append modifier]: ../modifiers-and-inserts/delayed-text.md</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><div class="intro references">
    <h1 id="references"><a class="header" href="#references">References</a></h1>
</div>
<p>This section contains quick references to specific Chapbook topics.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="inserts"><a class="header" href="#inserts">Inserts</a></h1>
<p>All of the below cause text or other types of content to appear in your passage. See <a href="references/../modifiers-and-inserts/">Modifiers and Inserts</a> for more information.</p>
<dl>
<dt>
<code>{ambient sound: 'sound name'<i>, volume: 0.5</i>}</code>
</dt>
<dd>
Begins playing a <a href="references/../multimedia/audio.html">previously-defined ambient sound</a>. <code>volume</code> can be omitted; by default, the ambient sound is played at full volume.
</dd>
<dt>
<code>{back link<i>, label: 'Back'</i>}</code>
</dt>
<dd>
Renders a link to the previous passage. <code>label</code> can be omitted; Chapbook will default to using 'Back'.
</dd>
<dt>
<code>{cycling link<i> for 'variableName'</i>, choices: ['one', 'two', 'three']}</code>
</td>
<dd>
Renders a cycling link that runs through the options listed in <code>choices</code>, saving the option the player selected to the variable named. <code>for 'variable name'</code> can be omitted; Chapbook will not save the selected value anywhere.
</dd>
<dt>
<code>{dropdown menu<i> for 'variableName'</i>, choices: ['one', 'two', 'three']}</code>
</td>
<dd>
Renders a dropdown menu that runs through the options listed in <code>choices</code>, saving the option the player selected to the variable named. <code>for 'variable name'</code> can be omitted; Chapbook will not save the selected value anywhere.
</dd>
<dt>
<code>{embed Flickr image: 'embed code', alt: 'alternate text'}</code>
<br>
abbreviated: <code>{embed Flickr: 'embed code', alt: 'alternate text'}</code>
</dt>
<dd>
Renders an image hosted on Flickr with alt text specified by <code>alt</code>.
</dd>
<dt>
<code>{embed image: 'url', alt: 'alternate text'}</code>
</dt>
<dd>
Renders an image at a particular URL with alt text specified by <code>alt</code>.
</dd>
<dt>
<code>{embed passage named: 'passage name'}</code>
<br>
abbreviated: <code>{embed passage: 'passage name'}</code>
</dt>
<dd>
Renders the passage named in the insert. This executes any vars section in that passage.
</dd>
<dt>
<dt>
<code>{embed Unsplash image: 'URL', alt: 'alternate text'}</code>
<br>
abbreviated: <code>{embed Unsplash: 'URL', alt: 'alternate text'}</code>
</dt>
<dd>
Renders an image hosted on Unsplash with alt text specified by <code>alt</code>.
</dd>
<dt>
<code>{embed YouTube video: 'URL'}</code>
<br>
abbreviated: <code>{embed YouTube: 'URL'}</code>
</dt>
<dd>
Renders a video player for a video hosted on YouTube.
</dd>
<dt>
<code>{link to: 'passage name or URL'<i>, label: 'label'</i>}</code>
</dt>
<dd>
Renders a link to a passage name or address. <code>label</code> may be omitted; Chapbook will use the passage name or URL as label instead.
</dd>
<dt>
<code>{restart link<i>, label: 'label'</i>}</code>
</dt>
<dd>
Renders a link that restarts the story. <code>label</code> may be omitted; Chapbook will use 'Restart' in that instance.
</dd>
<dt>
<code>{reveal link: 'label', text: 'revealed text'}</code>
</dt>
<dd>
Renders a link that expands to show the <code>text</code> property when clicked or tapped.
</dd>
<dt>
<code>{reveal link: 'label', passage: 'passage name'}</code>
</dt>
<dd>
Renders a link that expands to show the contents of the passage that has the name specified by the <code>passage</code> property when clicked or tapped.
</dd>
<dt>
<code>{sound effect: 'sound name'<i>, volume: 0.5</i>}</code>
</dt>
<dd>
Begins playing a [previously-defined sound effect][sound]. <code>volume</code> can be omitted; by default, the ambient sound is played at full volume.
</dd>
<dt>
<code>{text input<i> for: 'variable name'</i>, <i>required: false</i>}</code>
</td>
<dd>
Renders a text field, saving the text entered to the variable named. <code>for 'variable name'</code> can be omitted; Chapbook will not save the selected value anywhere. <code>required</code> can also be omitted; Chapbook will make the field required unless you specify otherwise.
</dd>
</dl>
<div style="break-before: page; page-break-before: always;"></div><h1 id="modifiers"><a class="header" href="#modifiers">Modifiers</a></h1>
<p>All of the below affect the text following them. See <a href="references/../modifiers-and-inserts/index.html">Modifiers and Inserts</a> for more information.</p>
<dl>
<dt>
<code>[after <i>time</i>]</code>
</dt>
<dd>
Causes the text to appear after a certain amount of time has passed after the passage is first displayed.
</dd>
<dt>
<code>[align center]</code>, <code>[align left]</code>, <code>[align right]</code>
</dt>
<dd>
Causes the text to be aligned a particular way. Aligning left isn't needed under normal circumstances, but is included for compeleteness's sake--use <code>[continue]</code> instead.
</dd>
<dt>
<code>[append]</code>
</dt>
<dd>
Used in conjunction with another modifier to have text immediately follow the text preceding it, instead of appearing in a new paragraph.
</dd>
<dt>
<code>[continue]</code>, <code>[cont'd]</code>, <code>[cont]</code>
</dt>
<dd>
Clears all previously active modifiers.
</dd>
<dt>
<code>[CSS]</code>
</dt>
<dd>
Acts like a <code>&lt;style&gt;</code> tag in the passage; the contents of the text will be interpreted as CSS rules instead of normal text.
</dd>
<dt>
<code>[else]</code>
</dt>
<dd>
Only displays the text if the previous <code>[if]</code> condition was not met. If no previous <code>[if]</code> appeared in the passage's source code, an error occurs.
</dd>
<dt>
<code>[if <i>expression</i>]</code>
</dt>
<dd>
Only displays the text if <i>expression</i> evaluates to true, or a truthy (<a href="https://developer.mozilla.org/en-US/docs/Glossary/Truthy">as defined by Javascript</a>) value.
</dd>
<dt>
<code>[ifalways <i>expression</i>]</code>
</dt>
<dd>
Acts like the <code>[if]</code> modifier, except that it always displays the text it affects, regardless of the condition. This can be useful for quick testing.
</dd>
<dt>
<code>[ifnever <i>expression</i>]</code>
</dt>
<dd>
Acts like the <code>[if]</code> modifier, except that it never displays the text it affects, regardless of the condition. This can be useful for quick testing.
</dd>
<dt>
<code>[JavaScript]</code>
</dt>
<dd>
Acts like a <code>&lt;script&gt;</code> tag in the passage; the contents of the text will be interpreted as JavaScript code instead of normal text. To write output from inside the text, use the function `write()`.
</dd>
<dt>
<code>[note to self]</code>, <code>[note]</code>, <code>[todo]</code>, <code>[fixme]</code>
</dt>
<dd>
Causes the text to never be visible to the player. This is useful for leaving notes or other information for yourself.
</dd>
<dt>
<code>[unless <i>expression</i>]</code>
</dt>
<dd>
Only displays the text if <i>expression</i> evaluates to false, or a falsy (<a href="https://developer.mozilla.org/en-US/docs/Glossary">as defined by Javascript</a>) value.
</dd>
</dl>
<div style="break-before: page; page-break-before: always;"></div><h1 id="version-history"><a class="header" href="#version-history">Version History</a></h1>
<h2 id="121-17-january-2021"><a class="header" href="#121-17-january-2021">1.2.1, 17 January 2021</a></h2>
<ul>
<li>If a variable is set to an array, it can now be dereferenced using an insert,
e.g. <code>{myArray[1]}</code>.</li>
<li>Mixing conditional modifiers with forks now behaves correctly.</li>
<li>Updated the Markdown renderer library used, Marked, to version 1.2.7.</li>
<li>Fixed typos in the guide.</li>
</ul>
<h2 id="120-6-july-2020"><a class="header" href="#120-6-july-2020">1.2.0, 6 July 2020</a></h2>
<p><strong>This introduces a change in how story progress is saved in players' browsers.
If you re-publish a story with this version of Chapbook that had been published
with an earlier one, players will lose their progress.</strong></p>
<ul>
<li>Adds a <code>passages()</code> function to <code>engine.story</code>, currently undocumented, for
use by author scripts. This provides access to all passages in the story.</li>
<li>Player progress is now saved using a combination of the story name and its
IFID. This is prevent collisions, e.g. if authors ever named two different
stories <code>Test</code>, saved progress would collide.</li>
<li>Now, when a player navigates to a new passage, the browser will always return
to the top. In the past, the scroll position on a sufficiently long passage
would remain the same.</li>
<li>Fixes a bug where changing style (via certain variables like
<code>config.style.page.font</code>) would cause an error message when restarting a
story.</li>
<li>Fixes a bug where the copy-and-paste section of the Style tab of Backstage did
not update when changes were made.</li>
<li>Corrects documentation about styling the header and footer (thanks,
<a href="https://github.com/klembot/chapbook/pull/77">Gospodin</a>).</li>
</ul>
<h2 id="111-17-may-2020"><a class="header" href="#111-17-may-2020">1.1.1, 17 May 2020</a></h2>
<ul>
<li>Fixes a bug introduced in 1.1.0 where nested lookup variables (like
<code>random.coinFlip</code>) did not work--which is to say, all of them.</li>
</ul>
<h2 id="110-10-may-2020"><a class="header" href="#110-10-may-2020">1.1.0, 10 May 2020</a></h2>
<ul>
<li>Adds a new insert, <code>{no ambient sound}</code>, which stops any existing ambient sound.</li>
<li>Adds a link to this documentation in the story format's description in Twine.</li>
<li>Updates browser support to <a href="https://github.com/browserslist/browserslist">browserslist</a>'s default preset.</li>
<li>Fixes a bug with using decimals in font sizes, e.g. <code>1.25rem</code>.</li>
<li>Fixes a bug where clicking a cycling link too fast could cause the web browser tab
to lock up.</li>
<li>Fixes a bug with the <code>{reveal link}</code> insert where paragraph ordering was incorrect.</li>
<li>Fixes a bug where setting <code>config.body.transition.name</code> to <code>none</code> caused paragraphs in passages to stack horizontally instead of vertically.</li>
<li>Fixes several bugs with using objects as variables.</li>
<li>Fixes some inaccurate parts of this guide.</li>
</ul>
<h2 id="100-18-august-2019"><a class="header" href="#100-18-august-2019">1.0.0, 18 August 2019</a></h2>
<p>Initial public release.</p>
<h2 id="002-19-october-2018"><a class="header" href="#002-19-october-2018">0.0.2, 19 October 2018</a></h2>
<ul>
<li>Fixes a bug where hard restarts in stories deleted the entire local storage
object, which could trash, among other things, the Twine story library if
you're using the web version (yikes). Thanks to Brendan Hennessy for
identifying this early.</li>
</ul>
<h2 id="001-14-october-2018"><a class="header" href="#001-14-october-2018">0.0.1, 14 October 2018</a></h2>
<p>Initial public prerelease.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-chapbook-lifecycle"><a class="header" href="#the-chapbook-lifecycle">The Chapbook Lifecycle</a></h1>
<p>The diagram below shows the overall flow of execution in Chapbook beginning from when the web browser first loads the page, and is mainly of use when extending Chapbook.</p>
<p><img src="references/lifecycle.svg" alt="Lifecycle Diagram" /></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
